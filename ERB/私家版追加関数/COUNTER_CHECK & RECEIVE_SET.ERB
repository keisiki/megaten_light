@COUNTER_CHECK,ARG,ARG:1
;ARG	공격者
;ARG:1	被공격者
SIF ARG < 0
	RETURN
SIF CFLAG:ARG:PTフラグ == CFLAG:(ARG:1):PTフラグ
	RETURN
SIF !ACTIONABLE_CHARA_F(ARG)
	RETURN
LOCAL:1 = 8
SIF TALENT:ARG:이능자 || TALENT:ARG:달인 || TALENT:ARG:인수라
	LOCAL:1 = 12
SIF CFLAG:ARG:PTフラグ < 1 && CFLAG:ARG:ボスフラグ
	LOCAL:1 = 20

LOCAL:2 = 0
FOR LOCAL,0,LOCAL:1
	LOCALS = 스킬{LOCAL+1}
	TRYCCALLFORM SKILL_COUNTER_ACTIONABLE_{ABL:ARG:LOCALS},ARG,ARG:1
		IF RESULT > 0
			LOCAL:2 = ABL:ARG:LOCALS
		ENDIF
	CATCH
	ENDCATCH
NEXT
FOR LOCAL,0,21
	LOCALS = 장비스킬{LOCAL+1}
	TRYCCALLFORM SKILL_COUNTER_ACTIONABLE_{ABL:ARG:LOCALS},ARG,ARG:1
		IF RESULT > 0
			LOCAL:2 = ABL:ARG:LOCALS
		ENDIF
	CATCH
	ENDCATCH
NEXT
IF LOCAL:2 > 0
		    SIF CFLAG:ARG:PTフラグ == 0
		    	SETCOLOR 0xff0033
		    SIF CFLAG:ARG:PTフラグ > 0
		    	SETCOLOR 0x33ffcc
			PRINTFORML ┏>CHARA━━━━━━━━━━┓　┏>ACT━━━━━━━━━━━━━━━━━━┓
			PRINTFORM ┃[{CFLAG:ARG:포지션,2}] %CALLNAME:ARG,21,LEFT%┃　┃
			CALLFORM SKILL_NAME_{LOCAL:2},ARG
			PRINTFORML %RESULTS,40,LEFT%┃
			PRINTFORMW ┗━━━━━━━━━━━━━┛　┗━━━━━━━━━━━━━━━━━━━━┛
			TFLAG:전투이벤트 = 20
			SWAP ARG,TARGET
			CALL BATTLE_EVENT,TARGET
			RESETCOLOR
			CALLFORM ACTION_{LOCAL:2}, TARGET,CPOS(ARG:1)
		    SIF CFLAG:TARGET:PTフラグ == 0
		    	SETCOLOR 0xff0033
		    SIF CFLAG:TARGET:PTフラグ > 0
		    	SETCOLOR 0x33ffcc
			CALL BATTLE_EVENT_ATTACK,TARGET,ARG:1
			PRINTL
			SWAP ARG,TARGET
			RESETCOLOR
ENDIF

@RECEIVE_SET,ARG = -1,ARG:1 = 0,ARG:2 = 0,ARG:3 = 0,ARG:4 = 0
SIF ARG:3 < 0
	ARG:3 = 0
IF ARG > -1
	CFLAG:ARG:現데미지 += ARG:3
	CFLAG:ARG:現ターン蓄積데미지 += ARG:3
	CFLAG:ARG:蓄積데미지 += ARG:3
	IF !FLAG:カウンター中
		SETBIT CFLAG:ARG:受けフラグ,ARG:1
		SETBIT CFLAG:ARG:受けフラグ,17 + ARG:2
		IF ARG:3 > 0 && !CFLAG:ARG:방어フラグ
			SETBIT CFLAG:ARG:受けフラグ,20
			SIF ARG:4 > 0
				SETBIT CFLAG:ARG:受けフラグ,21
			SIF MAXBASE:ARG:GET_TYPE(ARG:1) > 100 && MAXBASE:ARG:GET_TYPE(ARG:1) != 999
				SETBIT CFLAG:ARG:受けフラグ,22
		ENDIF
	ENDIF
ENDIF