;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:WRITE_IMG.ERB
;	Facility	:画像描画処理など
;
;	Licence		:ライセンスフリー
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		2019/08/03		ypa 					新規作成
;	002		2019/09/26		空気 					SHOP화면・조교화면の顔グラを個別に選択できるように
;	003		2020/02/02		木綿豆腐 				데빌시프터/식노/악마憑きは악마변신時の화면の顔グラを설정できるように
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

; WRITE_IMG 
; 　画像出힘
;   WRITE_IMG_1,WRITE_IMG_2を統合
; ARG   キャラクター番号
; ARG:1 画像種別
;       0:小(4行) 1:大:(6行) 
;       主に카야CHANG(S)用확장
;       10:機械小　11;機械大 20:흉조小 21:흉조大 30:지령小 31:지령大 40:야마小 41:야마大
; ARG:2 何行눈を出힘するか
;3095,汎用악마변신顔グラ
;3096,악마변신顔グラ
;3097,SHOP顔グラ
;3098,조교顔グラ
;3099,顔グラ
@WRITE_IMG, ARG, ARG:1, ARG:2, ARG:3=0
#DIM IMG_LOCAL
#DIM IMG_TYPE
IMG_LOCAL = GETCHARA(ARG)
IF ARG:3 == 0 && IMG_LOCAL > -1 && CFLAG:IMG_LOCAL:3091 == 1
;       -100:셋업・능력확인화면 0:SHOP화면 1:조교화면
;       2:초기リンク악마변신時 <- EDIT 003 ADD
;       3:汎用악마변신時       <- EDIT 003 ADD

	IMG_TYPE = 1

	IF ARG:1 == 0
		ARG = CFLAG:IMG_LOCAL:3097
		IMG_TYPE = 0
	ELSEIF ARG:1 == 1
		ARG = CFLAG:IMG_LOCAL:3098
	ELSEIF ARG:1 == 2
		ARG = CFLAG:IMG_LOCAL:3096
	ELSEIF ARG:1 == 3
		ARG = CFLAG:IMG_LOCAL:3095
	ELSEIF ARG:1 == -100
		ARG = CFLAG:IMG_LOCAL:3099
	ELSE
		ARG = CFLAG:IMG_LOCAL:3099
	ENDIF

	ARG:1 = IMG_TYPE
ENDIF

;リソース存在체크
SPRITECREATED @"A%TOSTR(ARG)%_%TOSTR(ARG:1)%_%TOSTR(ARG:2)%"
IF RESULT
	PRINT_IMG @"A%TOSTR(ARG)%_%TOSTR(ARG:1)%_%TOSTR(ARG:2)%"
ELSE
	; 종족 아이콘 처리추가
	IF (IMG_LOCAL > -1) 
		CALL RACE_ICON,ARG, ARG:2, IMG_LOCAL, ARG:1
	ELSE
		;中途半端にリソースがない場合の処理
		;今の所 偶数が小 奇数が大と판정する
		IF ARG:1 % 2 == 0
			PRINT_RECT 400
		ELSE
			PRINT_RECT 600
		ENDIF
	ENDIF
ENDIF

; GET_IMG_TYPE
;　画像種別取得
;  ARG   포지션
;  ARG:1 画像サイズ
;       0:小(4行) 1:大:(6行) 
;  ARG:2 표시箇所
;       -100:셋업・능력확인화면 0:SHOP화면 1:조교화면
;       2:초기リンク악마변신時 <- EDIT 003 ADD
;       3:汎用악마변신時       <- EDIT 003 ADD
;  RETURNF
;       0:小(4行) 1:大:(6行)  
;       主に카야CHANG(S)用확장
;       10:機械小　11;機械大 20:흉조小 21:흉조大 30:지령小 31:지령大 40:야마小 41:야마大
;       X00:X番눈画像小 X01:X番눈画像大
@GET_IMG_TYPE(ARG,ARG:1,ARG:2=-100)
#FUNCTION
IF CFLAG:ARG:이미지처리타입 == 1
	IF ARG:2 == -100
		IF ARG:1 == 0
			ARG:1 = 0
		ELSE
			ARG:1 = -100
		ENDIF
	ELSEIF ARG:2 == 0
		ARG:1 = 0
	ELSEIF ARG:2 == 1
		ARG:1 = 1
	ELSEIF ARG:2 == 2
		ARG:1 = 2
	ELSEIF ARG:2 == 3
		ARG:1 = 3
	ELSE
		ARG:1 = 1
	ENDIF
ELSE
	IF ARG:2 == 0 && CFLAG:ARG:SHOP顔グラ != CFLAG:ARG:顔グラ && ARG:1 < 2
		ARG:1 += CFLAG:ARG:SHOP顔グラ * 100
	ELSEIF ARG:2 == 1 && CFLAG:ARG:조교顔グラ != CFLAG:ARG:顔グラ && ARG:1 < 2
		ARG:1 += CFLAG:ARG:조교顔グラ * 100
;---- EDIT 003 ADD START -------------------------
	ELSEIF ARG:2 == 2 && CFLAG:ARG:악마변신顔グラ != CFLAG:ARG:顔グラ && ARG:1 < 2
		ARG:1 += CFLAG:ARG:악마변신顔グラ * 100
	ELSEIF ARG:2 == 3 && CFLAG:ARG:汎用악마변신顔グラ != CFLAG:ARG:顔グラ && ARG:1 < 2
		ARG:1 += CFLAG:ARG:汎用악마변신顔グラ * 100
;---- EDIT 003 ADD END -------------------------
	ELSEIF CFLAG:ARG:顔グラ > 0 && ARG:1 < 2
		ARG:1 += CFLAG:ARG:顔グラ * 100
	ENDIF
;대상が石嶺카야で、かつ카야が인간をやめている
	IF NO:ARG == 4629 && ABL:ARG:종족 != 0 && CFLAG:ARG:顔グラ < 1
		IF CSTR:ARG:종족명 == "기계의처녀"
			RETURNF ARG:1 + 10
		ELSEIF CSTR:ARG:종족명 == "흉조"
			RETURNF ARG:1 + 20
		ELSEIF CSTR:ARG:종족명 == "지령"
			RETURNF ARG:1 + 30
		ELSEIF CSTR:ARG:종족명 == "야마"
			RETURNF ARG:1 + 40
		ENDIF
	ENDIF
ENDIF
RETURNF ARG:1

; SHOW_IMG 
; 　조교キャラクターの画像出힘
;   SHOW_IMG_L,SHOW_IMG_Sを統合
; ARG   何行눈を出힘するか
; ARG:1 出힘先
;       0:SHOP화면(画像サイズ小:4行) 1:조교화면(画像サイズ大:6行) 
; ARG:2 画像がないときの代替アイコンフラグ
@SHOW_IMG, ARG, ARG:1, ARG:2
#DIMS TARGET_PADD
#DIMS ASSI_PADD
#DIM IMG_SIZE
#DIM IMG_TYPE

;今のところは出힘先=画像サイズ
IMG_SIZE = ARG:1

;표시位置調整用
IF ARG:1 == 0
	SELECTCASE ARG
		CASE 1, 3
			IF TARGET >= 0 && ASSI > 0
				TARGET_PADD  = %" "%
				ASSI_PADD    = %" "%
			ELSEIF TARGET >= 0 && 0 > ASSI
				TARGET_PADD  = %" "%
			ELSEIF 0 >= TARGET && ASSI > 0
				ASSI_PADD    = %" 　　　　　　"%
			ENDIF
		CASE 2, 4
			IF TARGET >= 0 && ASSI > 0
				TARGET_PADD  = %" "%
				ASSI_PADD    = %" "%
			ELSEIF TARGET >= 0 && 0 > ASSI
				TARGET_PADD  = %" "%
			ELSEIF 0 >= TARGET && ASSI > 0
				ASSI_PADD    = %"　　　　　"%
			ENDIF
	ENDSELECT
ENDIF

IF ARG:2 == 1
	IF TARGET >= 0 && ASSI > 0
		IMG_TYPE = GET_IMG_TYPE(TARGET, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:TARGET,IMG_TYPE)
			PRINTFORM %TARGET_PADD%
			CALL WRITE_IMG,NO:TARGET,IMG_TYPE,ARG
		ELSE
			PRINTFORM %TARGET_PADD%
			CALL RACE_ICON,NO:TARGET,ARG,TARGET,IMG_SIZE
		ENDIF
		IMG_TYPE = GET_IMG_TYPE(ASSI, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:ASSI,IMG_TYPE)
			PRINTFORM %ASSI_PADD%
			CALL WRITE_IMG,NO:ASSI,IMG_TYPE,ARG
		ELSE
			PRINTFORM %ASSI_PADD%
			CALL RACE_ICON,NO:ASSI,ARG,ASSI,IMG_SIZE
		ENDIF
	ELSEIF TARGET >= 0 && 0 > ASSI
		IMG_TYPE = GET_IMG_TYPE(TARGET, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:TARGET,IMG_TYPE)
			PRINTFORM %TARGET_PADD%
			CALL WRITE_IMG,NO:TARGET,IMG_TYPE,ARG
		ELSE
			PRINTFORM %TARGET_PADD%
			CALL RACE_ICON,NO:TARGET,ARG,TARGET,IMG_SIZE
		ENDIF
	ELSEIF 0 >= TARGET && ASSI > 0
		IMG_TYPE = GET_IMG_TYPE(ASSI, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:ASSI,IMG_TYPE)
			PRINTFORM %ASSI_PADD%
			CALL WRITE_IMG,NO:ASSI,IMG_TYPE,ARG
		ELSE
			PRINTFORM %ASSI_PADD%
			CALL RACE_ICON,NO:ASSI,ARG,ASSI,IMG_SIZE
		ENDIF
	ENDIF
ELSEIF ARG:2 == 2
	IF TARGET >= 0 && ASSI > 0
		IMG_TYPE = GET_IMG_TYPE(TARGET, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:TARGET,IMG_TYPE)
			PRINTFORM %TARGET_PADD%
			CALL WRITE_IMG,NO:TARGET,IMG_TYPE,ARG
		ELSE
			PRINTFORM %TARGET_PADD%
			CALL ONI_MARK,TARGET,ARG,IMG_SIZE
		ENDIF
		IMG_TYPE = GET_IMG_TYPE(ASSI, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:ASSI,IMG_TYPE)
			PRINTFORM %ASSI_PADD%
			CALL WRITE_IMG,NO:ASSI,IMG_TYPE,ARG
		ELSE
			PRINTFORM %ASSI_PADD%
			CALL ONI_MARK,ASSI,ARG,IMG_SIZE
		ENDIF
	ELSEIF TARGET >= 0 && 0 > ASSI
		IMG_TYPE = GET_IMG_TYPE(TARGET, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:TARGET,IMG_TYPE)
			PRINTFORM %TARGET_PADD%
			CALL WRITE_IMG,NO:TARGET,IMG_TYPE,ARG
		ELSE
			PRINTFORM %TARGET_PADD%
			CALL ONI_MARK,TARGET,ARG,IMG_SIZE
		ENDIF
	ELSEIF 0 >= TARGET && ASSI > 0
		IMG_TYPE = GET_IMG_TYPE(ASSI, IMG_SIZE,ARG:1)
		IF EXIST_PICTURE(NO:ASSI,IMG_TYPE)
			PRINTFORM %ASSI_PADD%
			CALL WRITE_IMG,NO:ASSI,IMG_TYPE,ARG
		ELSE
			PRINTFORM %ASSI_PADD%
			CALL ONI_MARK,ASSI,ARG,IMG_SIZE
		ENDIF
	ENDIF
ELSEIF ARG:2 == 3
	IF TARGET >= 0 && ASSI > 0
		PRINTFORM %TARGET_PADD%
		CALL ONI_MARK,TARGET,ARG,IMG_SIZE
		PRINTFORM %ASSI_PADD%
		CALL ONI_MARK,ASSI,ARG,IMG_SIZE
	ELSEIF TARGET >= 0 && 0 > ASSI
		PRINTFORM %TARGET_PADD%
		CALL ONI_MARK,TARGET,ARG,IMG_SIZE
	ELSEIF 0 >= TARGET && ASSI > 0
		PRINTFORM %ASSI_PADD%
		CALL ONI_MARK,ASSI,ARG,IMG_SIZE
	ENDIF
ENDIF
SIF ARG:1 == 0
	PRINTL
