;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#
;
;	Module		:STSTEM_DUNGEON.ERB
;	Facility	:던전ＲＰＧモジュール
;
;	Licence		:。
;
;	Modification Data:
;
;	Edit	Date			Author					Reason
;	001		20XX/XX/XX		----					新規作成
;	002		2011/11/06		旅人					統合整備(タイル文字の共通化)
;_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/#

@HONEY_BEE
#LOCALSIZE 6
;LOCALに今いる階を保存
LOCAL:2 = FLAG:現M
$HONEY_BEE_LOOP

CUSTOMDRAWLINE =
CALLFORM FLOORNAME_{FLAG:現던전}

PRINTL
IF !FLAG:DEBUG
	FOR LOCAL:1,0,FLAG:최대Y
		FOR LOCAL,0,FLAG:최대X
			IF FLAG:現X == LOCAL && FLAG:現Y == LOCAL:1 && (FLAG:現M == LOCAL:2)
				SETCOLOR 0x33ffcc
				PRINT ＠
				RESETCOLOR
				CONTINUE
			ENDIF
			IF DA:(FLAG:現X):(FLAG:現Y) % 10 == -1 && !((EQUIP:MASTER:다크스캐너 || EQUIP:MASTER:허니・비) && NUM_SUMMONER() ) && FLAG:라이트마 == 0 && ABS(LOCAL-FLAG:現X)+ABS(LOCAL:1-FLAG:現Y) > 1
				SETCOLOR 0x202020
				PRINT ？
				RESETCOLOR
				CONTINUE
			ENDIF
			IF GET_FLOOR_ANALYZE_T(LOCAL, LOCAL:1) > 0
				CALL DG_GET_TILE(LOCAL, LOCAL:1, FLAG:現M, FLAG:現던전)
				PRINTFORM %RESULTS%
			ELSE
				PRINT 　
			ENDIF
			RESETCOLOR
		NEXT
		PRINTL
	NEXT
ELSE
	FOR LOCAL:1,0,FLAG:최대Y
		FOR LOCAL,0,FLAG:최대X
			IF FLAG:現X == LOCAL && FLAG:現Y == LOCAL:1 && (FLAG:現M == LOCAL:2)
				SETCOLOR 0x33ffcc
				PRINT ＠
				RESETCOLOR
				CONTINUE
			ENDIF
			IF DA:(FLAG:現X):(FLAG:現Y) % 10 == -1 && !((EQUIP:MASTER:다크스캐너 || EQUIP:MASTER:허니・비) && NUM_SUMMONER() ) && FLAG:라이트마 == 0 && ABS(LOCAL-FLAG:現X)+ABS(LOCAL:1-FLAG:現Y) > 1
				SETCOLOR 0x202020
				PRINTBUTTON "？", LOCAL*100+LOCAL:1
				RESETCOLOR
				CONTINUE
			ENDIF
		IF GET_FLOOR_ANALYZE_T(LOCAL, LOCAL:1) > 0
			CALL DG_GET_TILE(LOCAL, LOCAL:1, FLAG:現M, FLAG:現던전)
			PRINTBUTTON RESULTS, LOCAL*100+LOCAL:1
		ELSE
			SETCOLOR 0x000000
			PRINTBUTTON "■", LOCAL*100+LOCAL:1
		ENDIF
		RESETCOLOR
	NEXT
	PRINTL
NEXT
ENDIF

$HONEY_BEE_INPUT_LOOP

FLAG:최대X = -1
FLAG:최대Y = -1
LOCAL:4 = 0
IF FLAG:現M > 0
	FLAG:現M--
	CALLFORM MAKE_FLOOR_{FLAG:現던전}
	FLAG:現M++
	SIF FLAG:최대X >= 0 && FLAG:최대Y >= 0
		LOCAL:4 = 1
	CALL MAKE_FLOOR, FLAG:現던전
	IF LOCAL:4
		PRINTL [0]PREV
	ELSE
		PRINTL 
	ENDIF
ENDIF
PRINTL 
FLAG:최대X = -1
FLAG:최대Y = -1
LOCAL:5 = 0
CALL D_VARSIZE , FLAG:現던전
IF RESULT >= 2 && FLAG:現M < RESULT-1
	FLAG:現M++
	CALLFORM MAKE_FLOOR_{FLAG:現던전}
	FLAG:現M--
	SIF FLAG:최대X >= 0 && FLAG:최대Y >= 0
		LOCAL:5 = 1
ENDIF
CALL MAKE_FLOOR, FLAG:現던전
IF LOCAL:5
	PRINTL [1]NEXT
ELSE
	PRINTL 
ENDIF
IF FLAG:DEBUG
	PRINTL 
	PRINTL [2]MAPPING
ENDIF
PRINTL 
PRINTL [100]돌아간다
PRINTL

INPUT
SELECTCASE RESULT
	CASE 0
		IF LOCAL:4
			FLAG:現M --
			CALL MAKE_FLOOR, FLAG:現던전
		ENDIF
		GOTO HONEY_BEE_LOOP
	CASE 1
		IF LOCAL:5
			FLAG:現M ++
			CALL MAKE_FLOOR, FLAG:現던전
		ENDIF
		GOTO HONEY_BEE_LOOP
	CASE 2
		IF FLAG:DEBUG
			;LOCAL:4 = 던전フラグ:(FLAG:現던전):(100+FLAG:現M%25) % POWER(100, FLAG:現M/25*2+1) / POWER(100, FLAG:現M/25*2)
			;LOCAL:5 = 던전フラグ:(FLAG:現던전):(100+FLAG:現M%25) % (POWER(100, FLAG:現M/25*2+2)) / (POWER(100, FLAG:現M/25*2+1))
			CALL FLOOR_ANALYZE
			;SAVESTR:GET_FLOOR_ANALYZE_NUM(FLAG:現던전, FLAG:現M) = %"2"* LOCAL:4 * LOCAL:5%
			;FOR LOCAL:1, 100, 100+LOCAL:5
			;	FOR LOCAL, 0, LOCAL:4
			;		DA:LOCAL:(LOCAL:1) = 2
			;	NEXT
			;NEXT
			;CALL MAKE_FLOOR, FLAG:現던전
		ENDIF
		GOTO HONEY_BEE_LOOP
	CASE 100
		;階層を戻して移動화면に戻る
		FLAG:現M = LOCAL:2
		CALL MAKE_FLOOR, FLAG:現던전
		CUSTOMDRAWLINE =
		RETURN 0
	CASEELSE
		IF FLAG:DEBUG
			CALL DUNGEON_WORP, FLAG:現M, RESULT / 100, RESULT%100
			RETURN 0
		ENDIF
		GOTO HONEY_BEE_INPUT_LOOP
ENDSELECT
