
;=======================================================================
;로카파라
;던전ナンバー13
;フラグ
;던전フラグ:13:0　報酬フラグ
;던전フラグ:13:1　이벤트進行度
;던전フラグ:13:2　地下街이벤트進行度
;던전フラグ:13:3　地下街ヒールスポット
;던전フラグ:13:4　収容所이벤트進行度
;던전フラグ:13:5　収容所그외이벤트
;던전フラグ:13:7　収容所限界歩数
;던전フラグ:13:6　カルマシティ占い師
;던전フラグ:13:8　占い効果
;던전フラグ:13:9　ローカパーラサブ이벤트

;던전フラグ:13:11　協会・空港이벤트進行度
;던전フラグ:13:12　協会그외이벤트
;던전フラグ:13:13　空港그외이벤트
;던전フラグ:13:14　空港윤간進行度

;던전フラグ:13:15　ラボ이벤트進行度
;던전フラグ:13:16　ラボ그외이벤트

;던전フラグ:13:17　プラント이벤트進行度
;던전フラグ:13:18　プラント그외이벤트（ビット演算）

;던전フラグ:13:19　仮想空間이벤트進行度
;던전フラグ:13:20　仮想空間그외이벤트（ビット演算）
;던전フラグ:13:21　仮想空間残りターン

;던전フラグ:13:22　ローカパーラサブ이벤트（ビット演算）
;던전フラグ:13:23　双葉訓練日付

;던전フラグ:13:24　地下街추가이벤트1
;던전フラグ:13:25　地下街추가이벤트2 3=마코토(페르소나5)　4＝안

;던전フラグ:13:26　宇宙の卵ボス進行度
;던전フラグ:13:27　宇宙の卵던전進行度
;던전フラグ:13:28　宇宙の卵그외이벤트（ビット演算）

;던전フラグ:13:29　太陽이벤트進行度
;던전フラグ:13:30　太陽그외이벤트（ビット演算）
;던전フラグ:13:31　太陽エレベータ開放度

;던전フラグ:13:80~ 宝箱管理用変数（ビット演算）
;=======================================================================

;=======================================================================
;攻略조건
;=======================================================================
@PREREQUISITE_DUNGEON_13
;闘技場 시합랭크Ｄ　ＶＳ　飢えに狂った女　クリア後
IF 던전フラグ:13:1 == 1 && 던전フラグ:13:0 < 2
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라 아지트（수용소）】가 출현！                      ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 2
ELSEIF 던전フラグ:13:1 == 3 && 던전フラグ:13:0 < 3
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라 아지트（카르마 협회）】가 출현！                  ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 3
ELSEIF 던전フラグ:13:1 == 5 && 던전フラグ:13:0 < 4
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라 아지트（EGG시설）】가 출현！                     ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 4
ELSEIF 던전フラグ:13:1 == 7 && 던전フラグ:13:0 < 5
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라 아지트（동력플랜트）】가 출현！                ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 5
ELSEIF 던전フラグ:13:1 == 9 && 던전フラグ:13:0 < 6
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라아지트（???）】が出現！                         ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 6
ELSEIF 던전フラグ:13:1 == 11 && 던전フラグ:13:0 < 7
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라아지트（????）】が出現！               　　     ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 7
ELSEIF 던전フラグ:13:1 == 13 && 던전フラグ:13:0 < 8
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라아지트（?????）】が出現！               　　    ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 8
ELSEIF 던전フラグ:13:1 == 15 && 던전フラグ:13:0 < 9
	PRINTL ┏>MESSAGE━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
	PRINTL ┃던전【로카파라아지트（太陽）】が出現！               　　    ┃
	PRINTW ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
	던전フラグ:13:0 = 9
ENDIF

IF 던전フラグ:13:1 > 0
	RETURN 1
ELSEIF FLAG:DEBUG || 투기장フラグ:16:0 == 1
	RETURN 1
ENDIF
RETURN 0



;=======================================================================
;던전名
;=======================================================================
@GET_DUNGEON_NAME_13
IF FLAG:DEBUG
	RESULTS = 로카파라 아지트
ELSEIF 던전フラグ:13:1 == 0
	RESULTS = 로카파라 아지트（지하가）
ELSEIF 던전フラグ:13:1 < 3
	RESULTS = 로카파라 아지트（수용소）
ELSEIF 던전フラグ:13:1 < 5
	RESULTS = 로카파라 아지트（카르마 협회）
ELSEIF 던전フラグ:13:1 < 7
	RESULTS = 로카파라 아지트（EGG시설）
ELSEIF 던전フラグ:13:1 < 9
	RESULTS = 로카파라 아지트（동력플랜트）
ELSEIF 던전フラグ:13:1 < 11
	RESULTS = 로카파라아지트（???）
ELSEIF 던전フラグ:13:1 < 13
	RESULTS = 로카파라아지트（????）
ELSEIF 던전フラグ:13:1 < 15
	RESULTS = 로카파라아지트（?????）
ELSEIF 던전フラグ:13:1 < 17
	RESULTS = 로카파라아지트（太陽）
ELSE
	RESULTS = 로카파라아지트（クリア済）
ENDIF
;=======================================================================
;フ로어名표시
;=======================================================================
@FLOORNAME_13
SELECTCASE FLAG:現M
	CASE 0
		PRINTL 로카파라
	CASE 1
		PRINTL 지하가 1
	CASE 2
		PRINTL 지하가 2
	CASE 3
		PRINTL 지하가 3
	CASE 4
		PRINTL 지하가 4
	CASE 5
		PRINTL 지하가 5
	CASE 6
		PRINTL 해저 케이블 1
	CASE 7
		PRINTL 해저 케이블 2
	CASE 8
		PRINTL 식료 플랜트 돔 공장군
	CASE 13
		PRINTL 수용소 1F
	CASE 12
		PRINTL 수용소 B1F
	CASE 11
		PRINTL 수용소 B2F
	CASE 10
		PRINTL 수용소 B3F
	CASE 9
		PRINTL 수용소 B4F
	CASE 15
		PRINTL 수용소 창고
	CASE 14
		PRINTL 카르마 시티 시가지
	CASE 16
		PRINTL 카르마 협회 본부 입구
	CASE 17
		PRINTL 카르마 협회 본부 ２Ｆ
	CASE 18
		PRINTL 카르마 협회 본부 １０Ｆ
	CASE 19
		PRINTL 카르마 협회 본부 １１Ｆ
	CASE 20
		PRINTL 카르마 협회 본부 ２０Ｆ　헬리포트
	CASE 21
		PRINTL 카르마 협회 본부 ２１Ｆ
	CASE 22
		PRINTL 카르마 협회 본부 ２２Ｆ
	CASE 23
		PRINTL 카르마 협회 본부 ４４Ｆ
	CASE 24
		PRINTL 카르마 협회 본부 ４５Ｆ
	CASE 25
		PRINTL 카르마 협회 본부 ５５Ｆ
	CASE 26
		PRINTL 공항 앞
	CASE 27
		PRINTL 공항 B2F
	CASE 28
		PRINTL 공항 B1F
	CASE 29
		PRINTL 공항 1F
	CASE 30
		PRINTL 공항 2F
	CASE 31
		PRINTL EGG시설 1F・입구
	CASE 33
		PRINTL EGG시설 B5F
	CASE 32
		PRINTL EGG시설 B6F
	CASE 34
		PRINTL EGG시설 B11F
	CASE 35
		PRINTL EGG시설 B10F
	CASE 36
		PRINTL EGG시설 B11F　퀴비에 증후군 연구실
	CASE 37
		PRINTL EGG시설B30F
	CASE 38
		PRINTL ???
	CASE 39
		PRINTL ???
	CASE 40
		PRINTL 동력플랜트　外
	CASE 41
		PRINTL 동력플랜트　B1F
	CASE 42
		PRINTL 동력플랜트　1F
	CASE 43
		PRINTL 동력플랜트　1F
	CASE 44
		PRINTL 双葉の정신세계
	CASE 45
		PRINTL 双葉の정신세계
	CASE 46
		PRINTL カルマ協会PCルーム
	CASE 47,48,49,50,51,52,53
		PRINTL 仮想空間
	CASE 54
		PRINTL カルマシティ　外
	CASE 55
		PRINTL 宇宙の卵1-1
	CASE 56
		PRINTL 宇宙の卵1-2
	CASE 57
		PRINTL 宇宙の卵2-1
	CASE 58
		PRINTL 宇宙の卵2-2
	CASE 59
		PRINTL 宇宙の卵3-1
	CASE 60
		PRINTL 宇宙の卵3-2
	CASE 61
		PRINTL 宇宙の卵3-3
	CASE 62
		PRINTL 宇宙の卵4
	CASE 63
		PRINTL 太陽への扉
	CASE 64
		PRINTL 太陽　対流層
	CASE 65	
		PRINTL 太陽　第二層　1F
	CASE 66	
		PRINTL 太陽　第二層　2F
	CASE 67	
		PRINTL 太陽　第二層　3F
	CASE 68	
		PRINTL 太陽　第二層　4F
	CASE 69	
		PRINTL 太陽　第二層　5F
	CASE 70	
		PRINTL 太陽　第三層　1F
	CASE 71	
		PRINTL 太陽　第三層　2F
	CASE 72	
		PRINTL 太陽　第三層　3F
	CASE 73	
		PRINTL 太陽　第三層　4F
	CASE 74	
		PRINTL 太陽　第四層　1F
	CASE 75	
		PRINTL 太陽　第四層　2F
	CASE 76	
		PRINTL 太陽　第四層　3F
	CASE 77	
		PRINTL 太陽　第四層　4F
	CASE 78	
		PRINTL 太陽　第五層　1F
	CASE 79	
		PRINTL 太陽　第五層　2F
	CASE 80	
		PRINTL 太陽　第五層　3F
	CASE 81	
		PRINTL 太陽　第五層　4F
	CASE 82	
		PRINTL 太陽　第六層　1F
	CASE 83	
		PRINTL 太陽　第六層　2F
	CASE 84	
		PRINTL 太陽　第六層　3F
	CASE 85	
		PRINTL 太陽　第六層　4F
	CASE 86	
		PRINTL 太陽　第六層　5F
ENDSELECT

;=======================================================================
;スタート地点입력
;=======================================================================
@START_DUNGEON_13,ARG
FLAG:現M = 0
FLAG:現X = 3
FLAG:現Y = 2
;CALL AUTOMAP

;=======================================================================
;攻略開始時の이벤트
;=======================================================================
@EVENT_DUNGEON_START_13
FLAG:탈출스킬禁止 = 1
IF 던전フラグ:13:23 > 0 && GETBIT(던전フラグ:13:22,0) && !GETBIT(던전フラグ:13:22,1) && (DAY - 던전フラグ:13:23) > 2
	CALL MESSAGE_WINDOW_D, "서프", "双葉は무기も使えるようになったし/防具も장비しても動けるようになったよ"
	CALL MESSAGE_WINDOW_D, "서프", "だが　実戦はさせてない/実戦は俺たちと共に戦いながら経験を積んでいくのがいいだろうな"
	CALL MESSAGE_WINDOW_D, "후타바", "よろしく頼むぜ "
	CALL MESSAGE_WINDOW_D, "", "双葉は十分な訓練を受けて전투に出せるようになった"
	CALL MESSAGE_WINDOW_D, "", "사쿠라　双葉が仲間になった "
	CALL ADD_NEW_COMPANION,[[キャラ:후타바]],100
				IF RESULT
					TALENT:(RESULT:1):비전투원 = 0
					CFLAG:(RESULT:1):전투참가불가능 = -1
					;CALL CHECK_LEVEL_UP, (RESULT:1)
				ENDIF
	SETBIT 던전フラグ:13:22,1
ENDIF

IF GETCHARA([[キャラ:치하야]]) > 0 && 함락(GETCHARA([[キャラ:치하야]])) > 0 && 던전フラグ:13:6 < 3 && 던전フラグ:13:1 > 2
	IF 던전フラグ:13:6 == 2
		CALL MESSAGE_WINDOW_D, "", "치하야가 카르마 시티에서 점술가를 재개한 것 같다"
	ELSE
		CALL MESSAGE_WINDOW_D, "", "치하야가 카르마 시티에서 점술가를 시작한 것 같다"
	ENDIF
	CALL MESSAGE_WINDOW_D, "", "카르마 시티 시가지에서 점을 볼 수 있게 되었다"
	CALL MESSAGE_WINDOW_D, "", "함락되어있는 치하야는 나에게는 무료로 점을 봐줄 것이다"
	
	
	던전フラグ:13:6 = 3
ENDIF

IF 던전フラグ:13:1 == 0
	CALL FLOOR_ANALYZE
	PRINTFORMW 팬텀으로부터 의뢰가 나왔다.
	PRINTFORML 이 지역에 있는 카르마 협회라고 하는 조직이 팬텀에도 영향을
	PRINTFORMW 미칠 정도의 연구를 하고 있는 것 같다고 한다.
	PRINTFORML 로알드라고 하는 남자가 카르마 협회에 대해서 알고 있기 때문에
	PRINTFORMW 그가 있는 지하가로 발길을 옮겼다.
ELSEIF 던전フラグ:13:1 == 1
	CALL FLOOR_ANALYZE
	CALL MESSAGE_WINDOW_D, "", "지하가에 오자/로알드가 말을 걸어왔다"
	CALL MESSAGE_WINDOW_D, "로알드", "여어、왔군/저번에는 수고했어"
	CALL MESSAGE_WINDOW_D, "로알드", "카르마 협회는 인류 존속을 위해/모든 인류를 악마화하려고 한다"
	CALL MESSAGE_WINDOW_D, "로알드", "모든 인류가 악마가 되면 인간은 제대로 살 수 없게 된다/이래서는 너의 조직 팬텀도 큰 타격을 받겠지"
	CALL MESSAGE_WINDOW_D, "로알드", "그렇지만 카르마 협회는 강대해/이대로 본부로 돌입해도 질 뿐이지"
	CALL MESSAGE_WINDOW_D, "로알드", "그래서 수용소에 가서 소장을 쓰러뜨려 주었으면 한다/그러면 우리쪽 포로도 몇 명 목숨을 건지겠지"
	CALL MESSAGE_WINDOW_D, "로알드", "카르마 협회가 병사를 수용소에 보내서 본부로 돌입하기 쉬워질 거야/그 틈에 본부에 들어가서 보스를 쓰러뜨리면 네 의뢰는 달성할 수 있다"
	CALL MESSAGE_WINDOW_D, "로알드", "너와 함께 싸웠던 식노와 다시 같이 싸우면/편하게 달성할 수 있을 거야"
	CALL MESSAGE_WINDOW_D, "로알드", "그건 그렇고 어때？/그들에 대해 자세히 듣고 싶지는 않나？"
	CALL INPUT_SELECT_D, "[0]듣고 싶다/[1]듣고 싶지 않다/[2]마코토 일행은？"
	IF RESULT == 0
		CALL MESSAGE_WINDOW_D, "로알드", "알았어、내 방으로 와줘 "
		CALL jank_event
	ELSEIF RESULT == 1
		CALL MESSAGE_WINDOW_D, "로알드", "그런가。아딜에게 말을 걸면/수용소로 가는 길을 알려줄 거야/다만 １０분 정도 기다려주지 않겠어？ "
		CALL MESSAGE_WINDOW_D, "", "＞당신은 １０분 정도 기다렸다/＞이제 로알드의 방 앞에 있는 아딜에게 말을 걸자/※아딜에게 말을 걸면 수용소에 갈 수 있습니다 "
	ELSEIF RESULT == 2
		CALL MESSAGE_WINDOW_D, "로알드", "아쉽지만 그녀들의 정보는/자세히 알아낼 수는 없었어 "
		CALL MESSAGE_WINDOW_D, "로알드", "몸에서 악마를 소환할 수 있는 능력/그 능력은 카르마병에게도 우리에게도 없어 "
		CALL MESSAGE_WINDOW_D, "로알드", "그녀는 꿈 속의 남자에게 능력을 받았다고/하는데 "
		CALL MESSAGE_WINDOW_D, "로알드", "식노처럼 굶주릴 일은 없는 것 같다만… "
		CALL MESSAGE_WINDOW_D, "로알드", "그건 그렇고 어때？/너와 함께 싸우는 식노에 대해 자세히 듣고 싶지 않나？"
		CALL INPUT_SELECT_D, "[0]듣고 싶다/[1]듣고 싶지 않다"
		IF RESULT == 0
			CALL MESSAGE_WINDOW_D, "로알드", "알았어、내 방으로 와줘 "
			CALL jank_event
		ELSEIF RESULT == 1
			CALL MESSAGE_WINDOW_D, "로알드", "그런가。아딜에게 말을 걸면/수용소로 가는 길을 알려줄 거야/다만 １０분 정도 기다려주지 않겠어？ "
			CALL MESSAGE_WINDOW_D, "", "＞당신은 １０분 정도 기다렸다/＞이제 로알드의 방 앞에 있는 아딜에게 말을 걸자/※아딜에게 말을 걸면 수용소에 갈 수 있습니다 "
		ENDIF
	ENDIF
	던전フラグ:13:5 = 1
	던전フラグ:13:1 = 2
ELSEIF 던전フラグ:13:1 == 3
	CALL MESSAGE_WINDOW_D, "", "지하가에 왔다"
	CALL MESSAGE_WINDOW_D, "", "로카파라는 이미 준비를 해놓고 있었다"
	CALL MESSAGE_WINDOW_D, "로알드", "로카파라는 이미 준비를 끝냈다/수용소를 혼란시키는 동안에 본부로 돌입하지"
	CALL MESSAGE_WINDOW_D, "로알드", "마코토 군、너희도 이 혼란을 틈 타서/카르마 시티에 동료가 없는지 찾으러 가도록 해"
	CALL MESSAGE_WINDOW_D, "로알드", "카르마 시티의 경비병도 적어졌을 것이다"
	CALL MESSAGE_WINDOW_D, "마코토", "감사합니다"
	CALL MESSAGE_WINDOW_D, "조직원", "이봐、얘기 좀 할까？"
	CALL MESSAGE_WINDOW_D, "", "갑자기 조직원이 말을 걸었다"
	CALL MESSAGE_WINDOW_D, "로알드", "뭐지？"
	CALL MESSAGE_WINDOW_D, "조직원", "그녀들에게 볼일이 있어"
	CALL MESSAGE_WINDOW_D, "안", "뭐、뭐야？"
	CALL MESSAGE_WINDOW_D, "조직원", "너희하고 비슷한 생김새를 한 여자애가/잘란다라에 쫓기고 있는 것을 봤거든"
	CALL MESSAGE_WINDOW_D, "조직원", "엉겁결에 그 애의 사진을 찍어왔는데/이 애、본 적 없어？"
	CALL MESSAGE_WINDOW_D, "", "마코토 일행은 사진을 본다"
	CALL MESSAGE_WINDOW_D, "", "그러자 그녀들의 표정이 크게 변했다"
	CALL MESSAGE_WINDOW_D, "안", "저、저기…/이 모습은"
	CALL MESSAGE_WINDOW_D, "류지", "이 옷、이 머리 모양…/설마…"
	CALL MESSAGE_WINDOW_D, "마코토", "하…하루쨩"
	CALL MESSAGE_WINDOW_D, "유스케", "어이、잘란다라는 뭐야？"
	CALL MESSAGE_WINDOW_D, "로알드", "잘란다라는 협회에서 악마화한 이후/군을 빠져나와 제멋대로 구는 놈들이다"
	CALL MESSAGE_WINDOW_D, "류지", "뭐라고！？/어이！왜 구하러 안 갔냐고！"
	CALL MESSAGE_WINDOW_D, "조직원", "어 어쩔 수 없었어/나 혼자였다고。역으로 당했을 거야"
	CALL MESSAGE_WINDOW_D, "마코토", "어디서 봤어요？"
	CALL MESSAGE_WINDOW_D, "조직원", "응、공항 근처에서 봤어"
	CALL MESSAGE_WINDOW_D, "류지", "공항이네/빨리 가자고！"
	CALL MESSAGE_WINDOW_D, "로알드", "잠깐、불량배이긴 해도 전직 군인/너희만 가면 위험하다"
	CALL MESSAGE_WINDOW_D, "류지", "그럼 어쩌라는 건데！/이러는 동안에 하루 선배가…"
	CALL MESSAGE_WINDOW_D, "시에로", "나、마코토 녀석들을 따라갈게"
	CALL MESSAGE_WINDOW_D, "안", "시에로？"
	CALL MESSAGE_WINDOW_D, "시에로", "너희의 동료가 죽을지도 모르잖아/내버려둘 수 없어"
	CALL MESSAGE_WINDOW_D, "알지라", "나도 갈게"
	CALL MESSAGE_WINDOW_D, "유스케", "알지라 씨도！？"
	CALL MESSAGE_WINDOW_D, "알지라", "동료를 잃는 기분、잘 알아/이 애들이 그런 일을 겪게 하고 싶지 않아"
	CALL MESSAGE_WINDOW_D, "로알드", "하지만 이러면 카르마 협회에 돌입할/멤버가 줄어들지 않나？"
	CALL MESSAGE_WINDOW_D, "서프", "그렇군…/마코토 일행의 동료를 두 명 정도 붙여줬으면 좋겠어"
	CALL MESSAGE_WINDOW_D, "류지", "내가 갈게"
	CALL MESSAGE_WINDOW_D, "류지", "나도 하루 선배가 걱정되지만/로카파라나 서프 씨네한테는 신세를 졌으니 가만 있을 수 없지"
	CALL MESSAGE_WINDOW_D, "안", "나도 갈래"
	CALL MESSAGE_WINDOW_D, "안", "우리가 하루쨩을 소중히 여기는 것처럼/서프 씨네가 세라쨩을 소중히 여기는 것도 마찬가지라고 생각하니까…"
	CALL MESSAGE_WINDOW_D, "로알드", "서프、이 멤버면 되겠지？"
	CALL MESSAGE_WINDOW_D, "서프", "그래、문제없어"
	CALL MESSAGE_WINDOW_D, "마코토", "번거롭게 해서 죄송해요"
	CALL MESSAGE_WINDOW_D, "게일", "신경 쓸 것 없다/우리는 너희의 동료를 찾는 것에 협력할 약속도 했다"
	CALL MESSAGE_WINDOW_D, "마코토", "감사합니다"
	
	
	PRINTFORMW 세라를 구출하러 갈지、하루를 구출하러 갈지 선택할 수 있습니다
	PRINTFORML 세라를 구출하러 갈 경우는 서프에게
	PRINTFORMW 하루를 구출하러 갈 경우는 마코토에게 이야기합시다
	
	던전フラグ:13:1 = 4
ELSEIF 던전フラグ:13:1 == 5
	CALL MESSAGE_WINDOW_D, "", "지하가에 왔다/로알드와 카르마 협회의 병대가 서로 이야기하고 있다"
	CALL MESSAGE_WINDOW_D, "", "잠시 후 카르마병은 돌아갔다"
	CALL MESSAGE_WINDOW_D, "로알드", "제나파의 병대들은 연구소를 습격하고 있다고 한다"
	CALL MESSAGE_WINDOW_D, "로알드", "지금이 세라를 구할 기회다/즉시 연구소로 가지"
	CALL MESSAGE_WINDOW_D, "로알드", "너희의 도움도 빌리겠는데、괜찮겠지？"
	CALL MESSAGE_WINDOW_D, "마코토", "네、좋아요"
	
	던전フラグ:13:1 = 6
ELSEIF 던전フラグ:13:1 == 7
	CALL MESSAGE_WINDOW_D, "서프", "ちょうどいいところに来たな"
	CALL MESSAGE_WINDOW_D, "서프", "ついさっき　突然出てきたクリシュナとか言う악마が/カルマシティ全土に映像付きで演説を始めたんだ"
	CALL MESSAGE_WINDOW_D, "서프", "救うとか　どうだか言っていたが信用できない/あまり　인간をよくするような奴らには見えんからな"
	CALL MESSAGE_WINDOW_D, "서프", "そして　演説していたところは動힘プラント/後ろには마코토達の仲間も映っていたらしい/名前はフタバというらしい"
	CALL MESSAGE_WINDOW_D, "서프", "俺たちが安全に先に進めるよう/ローカパーラがプラントの적を공격している"
	CALL MESSAGE_WINDOW_D, "서프", "それでわかったことは/なぜか　제나派のカルマ兵はなぜか多神連合に/協힘しているんだ"
	CALL MESSAGE_WINDOW_D, "서프", "なぜ　そんなことをしているんだろうな…"
	CALL MESSAGE_WINDOW_D, "서프", "とにかく　세라とフタバを助けるためにプラントに向かおう"
	CALL MESSAGE_WINDOW_D, "서프", "準備ができたらいつでも話しかけてくれ"
	
	던전フラグ:13:1 = 8
ELSEIF 던전フラグ:13:1 == 9
	CALL MESSAGE_WINDOW_D, "", "作戦室"
	CALL MESSAGE_WINDOW_D, "", "先日、全員気が沈んでいたが/だいぶ落ち着いてきている"
	CALL MESSAGE_WINDOW_D, "", "今後　どのようにするか作戦会議を開いていた"
	CALL MESSAGE_WINDOW_D, "로알드", "크리슈나　세라　そして마코토君達の友のレン…/皆　どこを探しても見つからなかった"
	CALL MESSAGE_WINDOW_D, "서프", "それだけじゃない　カルマシティの外に/変な物体もある"
	CALL MESSAGE_WINDOW_D, "서프", "カルマシティの連中は　突然現れたと言っていたな"
	CALL MESSAGE_WINDOW_D, "마코토(페르소나5)", "調べようにも　変な結界があって入れませんよね…"
	CALL MESSAGE_WINDOW_D, "시에로", "真上からもいけねえぜ/入るところが全然ねえ"
	CALL MESSAGE_WINDOW_D, "류지", "ぶち壊そうとしても/ビクともしねえしな"
	CALL MESSAGE_WINDOW_D, "게일", "あの復活したミロクをどうにかすれば結界を/消せそうだが…"
	CALL MESSAGE_WINDOW_D, "알지라", "そいつも全然見つからないのよね…"
	CALL MESSAGE_WINDOW_D, "서프", "…"
	CALL MESSAGE_WINDOW_D, "", "みんな打つ손なしという状況だった"
	CALL MESSAGE_WINDOW_D, "構成員", "すいません"
	CALL MESSAGE_WINDOW_D, "로알드", "どうした"
	CALL MESSAGE_WINDOW_D, "構成員", "なんか　ちっこい変な黒い奴が訪ねてきたんですよ/どうも　마코토達の仲間だとか言っているけど…"
	CALL MESSAGE_WINDOW_D, "構成員", "奴はモルガナと名乗っていたんですが"
	CALL MESSAGE_WINDOW_D, "안", "모르가나？"
	CALL MESSAGE_WINDOW_D, "春", "あの　もしかして尻꼬리と耳が生えてて/猫っぽい生き物ですか？"
	CALL MESSAGE_WINDOW_D, "構成員", "ま、まあ　そんな感じだな"
	CALL MESSAGE_WINDOW_D, "서프", "君たちの仲間か？"
	CALL MESSAGE_WINDOW_D, "유스케", "ああ　인간じゃないけどな…"
	CALL MESSAGE_WINDOW_D, "로알드", "ふむ…　何か有益な情報を持っているかもしれないな"
	CALL MESSAGE_WINDOW_D, "構成員", "実は　もう一人いるんですが…"
	CALL MESSAGE_WINDOW_D, "서프", "何？"
	CALL MESSAGE_WINDOW_D, "", "皆でモルガナに会いに行くと/猫が二발歩行した生き物と　머리카락の赤い青年がいた"
	CALL MESSAGE_WINDOW_D, "", "머리카락の赤い青年は서프がEGG施設で死んだと言っていた/히트だった"
	CALL MESSAGE_WINDOW_D, "히트", "よ…よお…"
	CALL MESSAGE_WINDOW_D, "서프", "히트！"
	CALL MESSAGE_WINDOW_D, "시에로", "히트ぉ！"
	CALL MESSAGE_WINDOW_D, "알지라", "히트…　うそでしょ！？"
	CALL MESSAGE_WINDOW_D, "서프", "お前　あの時死んだと思っていたぞ！"
	CALL MESSAGE_WINDOW_D, "시에로", "どうやってあの状況から生きてたんだ？"
	CALL MESSAGE_WINDOW_D, "알지라", "流石に　偽者じゃないわよね…"
	CALL MESSAGE_WINDOW_D, "히트", "んなわけねえだろ"
	CALL MESSAGE_WINDOW_D, "게일", "その動作や性格から見て本物のようだな"
	CALL MESSAGE_WINDOW_D, "서프", "お前がモルガナか？/히트を助けてくれたのか？"
	CALL MESSAGE_WINDOW_D, "모르가나", "いや　なんかその辺にいたから声をかけたんだ/ちょうど　お前らと同じような옷を着てたからな"
	CALL MESSAGE_WINDOW_D, "春", "モルちゃんも来てたのね"
	CALL MESSAGE_WINDOW_D, "류지", "全然見ねえから来てないと思ってたぜ"
	CALL MESSAGE_WINDOW_D, "안", "そうよね　尻꼬리も見えなかったもん"
	CALL MESSAGE_WINDOW_D, "유스케", "まあ　こんな세계で生き残ってくれて何よりだ/모르가나"
	CALL MESSAGE_WINDOW_D, "마코토(페르소나5)", "そうよね"
	CALL MESSAGE_WINDOW_D, "로알드", "ところで　多神連合や攫われた세라やレンのことについて/何か知っていないか？"
	CALL MESSAGE_WINDOW_D, "모르가나", "いや　俺は知らないが/一人多神連合の손がかりを知っていいるかもしれない"
	CALL MESSAGE_WINDOW_D, "서프", "誰なんだ？"
	CALL MESSAGE_WINDOW_D, "모르가나", "ここにいるフタバだ"
	CALL MESSAGE_WINDOW_D, "류지", "なんでだよ　双葉は奴らに操られていたんじゃねえのか？"
	CALL MESSAGE_WINDOW_D, "안", "そうよね　大体操られてた間って記憶なくなっちゃうよね"
	CALL MESSAGE_WINDOW_D, "게일", "いや　そうでもないかもしれないな"
	CALL MESSAGE_WINDOW_D, "류지", "え？　そうなの？"
	CALL MESSAGE_WINDOW_D, "게일", "プラントの停電は彼女の知識でやったものだとすれば/恐らく　完全には操られていないはずだ"
	CALL MESSAGE_WINDOW_D, "게일", "彼女を完全に操っていれば　その間の記憶は残らないだろうが/簡가운動作しかできないはずだ"
	CALL MESSAGE_WINDOW_D, "게일", "催眠のようなもので操られたのであれば/記憶は残っているだろうな"
	CALL MESSAGE_WINDOW_D, "모르가나", "お前なかなか冴えてるな/竜司のサル머리とは大違いだぜ"
	CALL MESSAGE_WINDOW_D, "류지", "誰がサル머리だ！"
	CALL MESSAGE_WINDOW_D, "마코토(페르소나5)", "その…双葉ちゃんなんだけど…/妙に눈を깨달음まさないのよね…"
	CALL MESSAGE_WINDOW_D, "유스케", "普通に寝てるような様子じゃ無いんだよな…"
	CALL MESSAGE_WINDOW_D, "안", "なんか苦しみながら寝てるような…"
	CALL MESSAGE_WINDOW_D, "모르가나", "なに？　ちょっとフタバの所に連れてってくれないか？"
	CALL MESSAGE_WINDOW_D, "", "モルガナを双葉の所に連れて行った"
	CALL MESSAGE_WINDOW_D, "모르가나", "これは…　정신に악마が入ってるな"
	CALL MESSAGE_WINDOW_D, "모르가나", "정신の中に入って악마をやっつけるしかねえ"
	CALL MESSAGE_WINDOW_D, "안", "でも　それができるアプリってもうないんじゃ…"
	CALL MESSAGE_WINDOW_D, "모르가나", "行くところはパレスじゃねえ/정신だ/双葉の정신세계に入って악마をやる"
	CALL MESSAGE_WINDOW_D, "서프", "そんなことができるのか？"
	CALL MESSAGE_WINDOW_D, "모르가나", "ああ　アン殿/ちょっとスマホを貸してくれないか？"
	CALL MESSAGE_WINDOW_D, "", "モルガナは杏のスマホを少しいじる"
	CALL MESSAGE_WINDOW_D, "안", "あ　なんかある"
	CALL MESSAGE_WINDOW_D, "모르가나", "そのアプリで정신세계に入ることが可能だぜ/リュウジ達にも後でつけてやるよ"
	CALL MESSAGE_WINDOW_D, "모르가나", "でも　フタバの정신はかなり弱ってきてる/これは　ボスを倒すまで戻ってこれねえかもな…"
	CALL MESSAGE_WINDOW_D, "모르가나", "中に入ってる악마も相当強힘だぜ/これは相当な準備が필요だ"
	CALL MESSAGE_WINDOW_D, "모르가나", "準備ができたらいつでも話しかけてくれ"
	CALL MESSAGE_WINDOW_D, "", "モルガナと히트が仲間になった"
				CALL ADD_NEW_COMPANION,4663,100
				IF RESULT
					BASE:(RESULT:1):LV = 60
					BASE:(RESULT:1):힘 = 17
					BASE:(RESULT:1):지혜 = 20
					BASE:(RESULT:1):마력 = 20
					BASE:(RESULT:1):인내력 = 8
					BASE:(RESULT:1):속도 = 20
					BASE:(RESULT:1):운 = 20
					;BASE:(RESULT:1):ＥＸＰ = 5*19*20*21/3
					EQUIP:(RESULT:1):검 = 2326
					EQUIP:(RESULT:1):머리 = 3057
					EQUIP:(RESULT:1):몸통 = 3555
					EQUIP:(RESULT:1):팔 = 4026
					EQUIP:(RESULT:1):발 = 4533
					;新페르소나処理
					IF BATTLE_SETTING_IS_PERSONA_NEW_FUNCTION()
					
					;旧페르소나処理
					ELSE
						LOCAL = CFLAG:(RESULT:1):초기페르소나ナンバー
						DITEMTYPE:LOCAL:페르소나("LV") = 45
						DITEMTYPE:LOCAL:페르소나("힘") = 15
						DITEMTYPE:LOCAL:페르소나("지혜") = 16
						DITEMTYPE:LOCAL:페르소나("마력") = 16
						DITEMTYPE:LOCAL:페르소나("인내력") = 7
						DITEMTYPE:LOCAL:페르소나("속도") = 16
						DITEMTYPE:LOCAL:페르소나("운") = 15
						DITEMTYPE:LOCAL:페르소나("스킬1") = 508;스쿤・다
						DITEMTYPE:LOCAL:페르소나("스킬2") = 1702;갈라
						DITEMTYPE:LOCAL:페르소나("스킬3") = 403;디아라한
						DITEMTYPE:LOCAL:페르소나("스킬4") = 420;자애의기도
						DITEMTYPE:LOCAL:페르소나("스킬5") = 1705;마하・갈라
						DITEMTYPE:LOCAL:페르소나("스킬6") = 261;럭키펀치
						DITEMTYPE:LOCAL:페르소나("스킬7") = 405;메・디아라마
						DITEMTYPE:LOCAL:페르소나("스킬8") = 531;하이・애널라이즈
					ENDIF
					CFLAG:(RESULT:1):전투참가불가능 = -1
					CALL SYNC_STATUS,(RESULT:1)
					CALL HEALTH_CHARA,(RESULT:1)
					;CALL CHECK_LEVEL_UP, (RESULT:1)
				ENDIF
				CALL ADD_NEW_COMPANION,[[キャラ:히트]],100
				IF RESULT
					BASE:(RESULT:1):LV = 60
					BASE:(RESULT:1):힘 = 34
					BASE:(RESULT:1):지혜 = 8
					BASE:(RESULT:1):마력 = 4
					BASE:(RESULT:1):인내력 = 30
					BASE:(RESULT:1):속도 = 20
					BASE:(RESULT:1):운 = 12
					;BASE:(RESULT:1):ＥＸＰ = 5*19*20*21/3
					CDFLAG:(RESULT:1):만트라:9 = 10000
					CDFLAG:(RESULT:1):만트라:21 = 10000
					CDFLAG:(RESULT:1):만트라:40 = 10000
					CDFLAG:(RESULT:1):만트라:41 = 10000
					CDFLAG:(RESULT:1):만트라:78 = 10000
					
					CDFLAG:(RESULT:1):만트라:29 = 10000
					CDFLAG:(RESULT:1):만트라:50 = 10000
					CDFLAG:(RESULT:1):만트라:49 = 10000
					EQUIP:(RESULT:1):총 = 2558
					EQUIP:(RESULT:1):머리 = 3057
					EQUIP:(RESULT:1):몸통 = 3562
					EQUIP:(RESULT:1):팔 = 4033
					EQUIP:(RESULT:1):발 = 4542
					CFLAG:(RESULT:1):전투참가불가능 = -1
					CALL SYNC_STATUS,(RESULT:1)
					CALL HEALTH_CHARA,(RESULT:1)
					ABL:(RESULT:1):초기변신악마스킬1 = 703;아기다인
					ABL:(RESULT:1):초기변신악마스킬2 = 738;화염드레인
					ABL:(RESULT:1):초기변신악마스킬3 = 211;기간피스트
					ABL:(RESULT:1):초기변신악마스킬4 = 304;메가클로
					ABL:(RESULT:1):초기변신악마스킬5 = 2058;폭음폭식
					ABL:(RESULT:1):초기변신악마스킬6 = 326;베어먹기
					ABL:(RESULT:1):초기변신악마스킬7 = 215;아카샤아츠
					ABL:(RESULT:1):초기변신악마스킬8 = 4;양팔찍기
					;CALL CHECK_LEVEL_UP, (RESULT:1)
				ENDIF
	던전フラグ:13:1 = 10
ELSEIF 던전フラグ:13:1 == 11
	CALL MESSAGE_WINDOW_D, "서프", "フタバが起き上がった"
	CALL MESSAGE_WINDOW_D, "서프", "フタバによるとカルマ協会のパソコンで/仮想空間を作ったみたいなんだ"
	CALL MESSAGE_WINDOW_D, "서프", "その空間にマダム派の作業員がアクセスしようとしていたが/おかしなロックがあったらしい"
	CALL MESSAGE_WINDOW_D, "서프", "だが　いくらハッキングしてもなかなか繋がらないみたいなんだ"
	CALL MESSAGE_WINDOW_D, "서프", "だから今フタバにハッキングさせている"
	CALL MESSAGE_WINDOW_D, "서프", "だが　奴らが何かしてるのか/何か細工をしてアクセスが容易にできないらしい"
	CALL MESSAGE_WINDOW_D, "서프", "フタバによると해제できるが時間がかかると言っていいたな"
	CALL MESSAGE_WINDOW_D, "서프", "フタバの予定では今ぐらいに해제できるそうだ"
	CALL MESSAGE_WINDOW_D, "서프", "準備ができたらいつでも話しかけてくれ"
	
	던전フラグ:13:1 = 12
ELSEIF 던전フラグ:13:1 == 13
	CALL MESSAGE_WINDOW_D, "서프", "準備はできたか？"
	CALL MESSAGE_WINDOW_D, "서프", "結界が弱まって/あの物体に近づけるようになった"
	CALL MESSAGE_WINDOW_D, "서프", "早くあそこに行き/세라とレンを助けに行こう"
	CALL MESSAGE_WINDOW_D, "서프", "準備ができたらいつでも話しかけてくれ"
	
	던전フラグ:13:1 = 14
ELSEIF 던전フラグ:13:1 == 15
	;太陽이벤트
	
	CALL MESSAGE_WINDOW_D, "", "作戦室"
	CALL MESSAGE_WINDOW_D, "로알드", "我々は세라を助けることができたが…/神と交信できる装置が全て破壊されてしまった…"
	CALL MESSAGE_WINDOW_D, "세라", "まだ　손はあるわ"
	CALL MESSAGE_WINDOW_D, "세라", "昔は　ここからずっと離れた施設で/実験をしていたの"
	CALL MESSAGE_WINDOW_D, "세라", "その施設が生きていれば…"
	CALL MESSAGE_WINDOW_D, "로알드", "その施設なんだが…"
	CALL MESSAGE_WINDOW_D, "로알드", "カルマ協会が　その施設に行ったのだが…/壊れていて使えない상태だったようだ…"
	CALL MESSAGE_WINDOW_D, "세라", "そんな…"
	
	CALL MESSAGE_WINDOW_D, "謎の声", "その心配はない"
	CALL MESSAGE_WINDOW_D, "", "声のある方を振り向くと1匹の黒猫がいた"
	CALL MESSAGE_WINDOW_D, "류지", "모르가나…/猫になって何やってんだ？"
	CALL MESSAGE_WINDOW_D, "모르가나", "俺はこっちだぞ！"
	CALL MESSAGE_WINDOW_D, "세라", "シュレ디무ンガー！？"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "宇宙の卵で손に入れた石柱…/それを持って宇宙の卵の所に来てくれ"

	CALL MESSAGE_WINDOW_D, "", "宇宙の卵に向かった"
	CALL MESSAGE_WINDOW_D, "", "猫が言うには石柱を宇宙の卵に刺し/세라が歌えば神への道が開かれるという"
	CALL MESSAGE_WINDOW_D, "", "その通りすると宇宙の卵は大きなモノリスに変わった"

	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "その扉に入れば神への道…　太陽へ行ける"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "神のもとに直接行くことができる"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "人の無限の可能性を　神に示すんだ"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "大切な仲間たちと一緒にね"
	CALL MESSAGE_WINDOW_D, "게일", "帰りはどうする"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "これを通った先にも同じようなものがある/それを通ればここに戻ることができる"
	
	CALL MESSAGE_WINDOW_D, "세라", "당신は一体…"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "もうすぐわかる"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "意識の翼を広げてごらん"
	CALL MESSAGE_WINDOW_D, "シュレ디무ンガー？", "君に感じられないことなんて/ないはずだよ"
	
	CALL MESSAGE_WINDOW_D, "", "そう言い残すと　その黒猫から何か出て行ったような感じがした"
	CALL MESSAGE_WINDOW_D, "", "その後　ニャアと普通の猫のように鳴き/その場を去っていった"
	
	PRINTFORMW 太陽への道には出입からいけます
	PRINTFORMW 今後から토라에스트で帰還できるようになました
	PRINTFORMW ジャ란다ーラは殲滅され、アジトにも行けなくなりました
	IF GETBIT(FLAG:発見ED, 45)
		던전フラグ:13:31 ++
		CALL MESSAGE_WINDOW_D, "", "クリアボーナス！/エレベーターから/ボスに直行できるようになった "
	ENDIF
	
	던전フラグ:13:1 = 16
ENDIF
SIF 던전フラグ:13:1 > 15
	FLAG:탈출스킬禁止 = 0

;=======================================================================
;탈출時の이벤트
;=======================================================================
@EVENT_DUNGEON_END_13
IF 던전フラグ:13:1 == 1
	CALL MESSAGE_WINDOW_D, "", @"＞카르마병을 토벌한 것으로 인해 ￥100000이 지급되고 명성 40을 얻었다"
	MONEY += 100000
	FLAG:名声 += 40
ENDIF

IF GETCHARA([[キャラ:치하야]]) > 0 && 함락(GETCHARA([[キャラ:치하야]])) > 0 && 던전フラグ:13:6 == 3 && 던전フラグ:13:1 > 2
	LOCAL = (50+ RAND:100) * 함락(GETCHARA([[キャラ:치하야]]))
	CALL MESSAGE_WINDOW_D, "", @"치하야는" + TOSTR(LOCAL) + "마카를 벌어왔다"
	MONEY:1 += LOCAL
	
ENDIF
던전フラグ:13:8 = 0
FLAG:탈출스킬禁止 = 0
;=======================================================================
;指定したマスに進入可能か
;=======================================================================
@CAN_ENTER_13,ARG,ARG:1
;DA:ARG:(ARG:1)
;ARG、ARG:1はそれぞれ대상のマスのX、Y座標を表しています。
;この던전ではエレベーターの扉が一度右側から開けておかないと左側からは開けられない、という処理に사용しています。
;どのマップでも座標(2,7)がエレベータの扉。던전フラグ:1:13 ＝ エレベータフラグ管理用変数の{現在のマップ番号}番눈のビットが立っていなければ開けられるかどうかの판정を行う

CALL 高低差_13,(FLAG:現X),(FLAG:現Y)
LOCAL:0 = RESULT
CALL 高低差_13,ARG,ARG:1
LOCAL:1 = RESULT

IF LOCAL:1 != 99
	IF LOCAL:1 - LOCAL:0 > 1
		CALL MESSAGE_WINDOW_D, "", "너무 높아서 기어오를 수 없다… "
		RETURN 0
	ENDIF
ENDIF
SIF DA:(ARG:0):(ARG:1) == 12 && FLAG:現Y < ARG:1
	RETURN 0
SIF DA:(ARG:0):(ARG:1) == 22 && FLAG:現Y > ARG:1
	RETURN 0
SIF DA:(ARG:0):(ARG:1) == 32 && FLAG:現X > ARG:0
	RETURN 0
SIF DA:(ARG:0):(ARG:1) == 42 && FLAG:現X < ARG:0
	RETURN 0

IF FLAG:現M > 2 && FLAG:現M < 9
	CALL tikagai_ENTER,ARG,ARG:1
ELSEIF FLAG:現M > 8 && FLAG:現M < 14
	CALL shuyoujo_ENTER,ARG,ARG:1
ELSEIF FLAG:現M == 15
	CALL shuyoujo2_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 26
	CALL kyoukai_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 31
	CALL airport_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 40
	CALL rabo_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 44
	CALL plant_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 46
	CALL SEISIN_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 54
	CALL kasou_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 63
	CALL tamago_ENTER,ARG,ARG:1
ELSEIF FLAG:現M < 95
	CALL taiyou_ENTER,ARG,ARG:1
ELSE
	CALL OTHER_ENTER_13
ENDIF
SIF RESULT == 0
	RETURN 0

CALL CAN_ENTER,ARG,ARG:1
RETURN RESULT

@OTHER_ENTER_13
	RETURN 1
;=======================================================================
;ターミナル名前
;=======================================================================
@GET_FLOORNAME_13
SELECTCASE FLAG:現M
	CASE 0
		RESULTS = 로카파라
	CASE IS < 6
		RESULTS = 地下街
	CASE IS < 8
		RESULTS = 海底ケーブル
	CASE IS < 14
		RESULTS = 収容所
	CASE IS < 26
		RESULTS = カルマ協会本部
	CASE IS < 31
		RESULTS = 空港
ENDSELECT
;=======================================================================
;タイル定義
;=======================================================================
@DEFINE_TILES_13, ARGS, ARG, ARG:1
#LOCALSIZE 1

;-----------------------------------------------------------------------
;共通
;-----------------------------------------------------------------------
;S 高低差1
SIF ARGS == "S"
	RETURN 15
;M 高低差2
SIF ARGS == "M"
	RETURN 25
;L 高低差3
SIF ARGS == "L"
	RETURN 35

;落とし穴
SIF ARGS == "H"
	RETURN 95

;↑滑り
SIF ARGS == "A"
	RETURN 11
;↓滑り
SIF ARGS == "V"
	RETURN 21
;→滑り
SIF ARGS == ">"
	RETURN 31
;←滑り
SIF ARGS == "<"
	RETURN 41

;滑る床
SIF ARGS == "*"
	RETURN 51

;ループ床
SIF ARGS == "ﾙ"
	RETURN 101

;↑扉
SIF ARGS == "ﾍ"
	RETURN 12
;↓扉
SIF ARGS == "Y"
	RETURN 22
;→扉
SIF ARGS == "}"
	RETURN 32
;←扉
SIF ARGS == "{"
	RETURN 42
;特殊床
SIF ARGS == "I"
	RETURN 92
	

;-----------------------------------------------------------------------
;共通
;-----------------------------------------------------------------------
;=======================================================================
;タイル調整
;=======================================================================
;ARG:1、ARG:2はそれぞれX座標とY座標
;ARGはその座標に現在代入されている番号
;0：壁　1：床もしくは通路　2：扉　3：宝箱　4：이벤트　5：罠　6：上り階段 7：下り階段　8：出입　9：그외特殊処理等
;これらの内、3〜9が代入されているマスに、個別の番号を与える処理を実行します。
;この処理を行った後、これらのマスには 「マップ番号*1000 + そのマスがそのマップで左上から数えて何個눈のARG타입のマスか*10 + ARG」が代入されます
;例えば 2003 であった場合、「2番のマップ＝３Ｆで、左上から数えて0個눈の3＝宝箱である」という事を意味しています
;尚、0〜2はどのマップにも大量に設置されるので、ここでは기본的に個別の番号を与えません。
;
;何個눈のARG타입のマスなのか、は左上の(0,0)から右まで探し、その後一つ下の段に移って同様に探す、というのを右下まで繰り返して数えます。
@MAKE_FLOOR_LINE_COMMON_13, ARG, ARG:1, ARG:2
#LOCALSIZE 10
;LOCAL:0〜9 それぞれ何個눈のARGなのかを記憶しています
;LOCAL:3 宝箱→사용フラグは던전フラグ:70~74
;指定された座標が(0,0)である場合、つまり新しいマップを読み込んだ時はLOCALを소거します
;SIF ARG:1 == 0 && ARG:2 == 0
;	VARSET LOCAL
IF ARG:1 == 0 && ARG:2 == 0
	VARSET LOCAL
	CALLF ループ関数_13,-1,-1
	SIF DA:(ARG:1):(ARG:2) == 101
		CALLF ループ関数_13,1
ENDIF
SELECTCASE ARG
	CASE 3
		;宝箱は多くの場合、開けたフラグが立っていると床を代入します
		;そのマップでどの宝箱を開けたかは、そのマップの宝箱管理用変数の何番눈のビットが立っているかで判断します
		IF GETBIT(던전フラグ:(FLAG:現던전):(FLAG:現M / 5 + 80), (FLAG:現M % 5 * 10 + LOCAL:3))
			DA:(ARG:1):(ARG:2) = 1
		ELSE
			DA:(ARG:1):(ARG:2) = FLAG:現M *1000 + LOCAL:3 * 10 + 3
		ENDIF
		LOCAL:3++
	CASE 4 TO 9
		DA:(ARG:1):(ARG:2) = FLAG:現M *1000 + LOCAL:ARG * 10 + ARG
		LOCAL:ARG++
	CASE IS > 9
		DA:(ARG:1):(ARG:2) = ARG
ENDSELECT

@ループマップ作製_13
#LOCALSIZE 4
#DIM X軸,2
#DIM Y軸,2

FOR Y軸,0,FLAG:최대Y
	LOCAL = 0
	FOR X軸,0,FLAG:최대X
		IF DA:X軸:Y軸 == 101
			LOCAL++
			SIF ループ関数_13(0,1) > -2 && ループ関数_13(0,2) < -1
				CALLF ループ関数_13(X軸,2)
		ELSEIF ループ関数_13(0,1) < -1
			CALLF ループ関数_13(X軸 - 1,1)
			CALLF ループ関数_13(Y軸 - 1,3)
		ENDIF
		SIF ループ関数_13(0,3) > -2 && ループ関数_13(0,4) < -1 && FLAG:최대X == LOCAL
			CALLF ループ関数_13(Y軸,4)
	NEXT
NEXT
LOCAL:0 = ループ関数_13(0,2) - ループ関数_13(0,1) - 1
LOCAL:1 = ループ関数_13(0,4) - ループ関数_13(0,3) - 1
FOR Y軸,0,FLAG:최대Y
	LOCAL:3 = - LOCAL:1
	SIF Y軸 + LOCAL:3 < 0
		LOCAL:3 = LOCAL:1
	FOR X軸,0,FLAG:최대X
		IF DA:X軸:Y軸 == 101
			LOCAL:2 = - LOCAL:0
			SIF X軸 + LOCAL:2 < 0
				LOCAL:2 = LOCAL:0
			X軸:1 = X軸 + LOCAL:2
			Y軸:1 = Y軸 + LOCAL:3
			DO
				SIF (Y軸:1 < 0 || Y軸:1 >= FLAG:최대Y) && ( X軸:1 < 0 || X軸:1 >= FLAG:최대X )
					BREAK
				IF Y軸:1 < FLAG:최대Y && DA:X軸:(Y軸:1) != 101
					DA:X軸:Y軸 = DA:X軸:(Y軸:1)
				ELSEIF X軸:1 < FLAG:최대X && DA:(X軸:1):Y軸 != 101
					DA:X軸:Y軸 = DA:(X軸:1):Y軸
				ELSE
					DA:X軸:Y軸 = DA:(X軸:1):(Y軸:1)
				ENDIF
				X軸:1 += LOCAL:2
				Y軸:1 += LOCAL:3
			LOOP DA:X軸:Y軸 == 101
			SIF DA:X軸:Y軸 % 10 == 6 || DA:X軸:Y軸 % 10 == 7
				DA:X軸:Y軸 = DA:X軸:Y軸 % 10
		ENDIF
	NEXT
NEXT

@ループ踏破_13
#LOCALSIZE 4
#DIM X軸,2
#DIM Y軸,2
LOCAL:0 = ループ関数_13(0,2) - ループ関数_13(0,1) - 1
LOCAL:1 = ループ関数_13(0,4) - ループ関数_13(0,3) - 1
FOR Y軸,0,FLAG:최대Y
	LOCAL:3 = - LOCAL:1
	SIF Y軸 + LOCAL:3 < 0
		LOCAL:3 = LOCAL:1
	FOR X軸,0,FLAG:최대X
		IF GET_FLOOR_ANALYZE_T(X軸,Y軸) < 2
			LOCAL:2 = - LOCAL:0
			SIF X軸 + LOCAL:2 < 0
				LOCAL:2 = LOCAL:0
			X軸:1 = X軸 + LOCAL:2
			Y軸:1 = Y軸 + LOCAL:3
			IF Y軸:1 < FLAG:최대Y && GET_FLOOR_ANALYZE_T(X軸,Y軸:1) > 0
				CALL SET_FLOOR_ANALYZE(GET_FLOOR_ANALYZE_T(X軸,Y軸:1), FLAG:現던전, FLAG:現M,X軸,Y軸)
			ELSEIF X軸:1 < FLAG:최대X && GET_FLOOR_ANALYZE_T(X軸:1,Y軸) > 0
				CALL SET_FLOOR_ANALYZE(GET_FLOOR_ANALYZE_T(X軸:1,Y軸), FLAG:現던전, FLAG:現M,X軸,Y軸)
			ENDIF
		ENDIF
	NEXT
NEXT

@ループワープ_13
#LOCALSIZE 2
LOCAL:0 = ループ関数_13(0,2) - ループ関数_13(0,1) - 1
LOCAL:1 = ループ関数_13(0,4) - ループ関数_13(0,3) - 1
IF FLAG:現X <= ループ関数_13(0,1)
	FLAG:現X += LOCAL:0
ELSEIF FLAG:現X >= ループ関数_13(0,2)
	FLAG:現X -= LOCAL:0
ENDIF
IF FLAG:現Y <= ループ関数_13(0,3)
	FLAG:現Y += LOCAL:1
ELSEIF FLAG:現Y >= ループ関数_13(0,4)
	FLAG:現Y -= LOCAL:1
ENDIF

@ループ関数_13,ARG = 0,ARG:1 = 0
#FUNCTION
#LOCALSIZE 5
IF ARG:1 == -1
	LOCAL:1 = -2;Xループ始め
	LOCAL:2 = -2;Xループ終わり
	LOCAL:3 = -2;Yループ始め
	LOCAL:4 = -2;Yループ終わり
	SIF ARG == -1
		LOCAL = 0
ELSEIF ARG:1 > 0 && ARG:1 < 5 && ARG > 0
	LOCAL:(ARG:1) = ARG
ELSEIF ARG:1 > 0 && ARG:1 < 5 && ARG == 0
	RETURNF LOCAL:(ARG:1)
ENDIF
IF ARG:1 == 0
	IF ARG == -1
		LOCAL = 0
	ELSEIF ARG == 1
		LOCAL = 1
	ELSEIF ARG == 0
		RETURNF LOCAL
	ENDIF
ENDIF

;=======================================================================
;特殊タイル표시
;TILE_MARK_COMMON_{FLAG:現던전}_X
;=======================================================================
;ARG:1、ARG:2がX座標とY座標
;ARGはそこに代入されている値
;RESULTSに代入した文字がマップに표시されますが、必ず全角1文字分になるようにしてください。そうでないと표시が崩れます。
;IF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2

@TILE_MARK_COMMON_13_4, ARG , ARG:1 , ARG:2
IF (ARG / 10) < 100
	CALL Lokapala_TILE, ARG 
ELSEIF (ARG / 10) < 600
	CALL tikagai_TILE, ARG
ELSEIF (ARG / 10) < 1400
	CALL shuyoujo_TILE, ARG 
ELSEIF FLAG:現M == 14
	CALL karumasity_TILE, ARG
ELSEIF FLAG:現M < 26
	CALL kyoukai_TILE, ARG 
ELSEIF FLAG:現M < 31
	CALL airport_TILE, ARG 
ELSEIF FLAG:現M < 40
	CALL rabo_TILE, ARG  
ELSEIF FLAG:現M < 44
	CALL plant_TILE, ARG 
ELSEIF FLAG:現M < 46
	CALL SEISIN_TILE, ARG 
ELSEIF FLAG:現M < 54
	CALL kasou_TILE, ARG 
ELSEIF FLAG:現M < 63
	CALL tamago_TILE, ARG 
ELSEIF FLAG:現M < 95
	CALL taiyou_TILE, ARG 
ELSE
	RETURN 1
ENDIF
;特に설정しない場合、"！"と표시されます


@TILE_MARK_COMMON_13_9, ARG , ARG:1 , ARG:2
SELECTCASE ARG / 10
	CASE 0
		IF 던전フラグ:13:1 > 0
			SETCOLOR 0xaa44ff
			RESULTS = Ｔ
		ELSE
			RESULTS = □
		ENDIF
	CASE 1
		IF 던전フラグ:13:1 > 0
			SETCOLOR 0xaa44ff
			RESULTS = ST
		ELSE
			RESULTS = □
		ENDIF
	CASE 2
		SETCOLOR 0xff7300
		RESULTS = イ
	CASEELSE
ENDSELECT
IF (ARG / 10) > 99 && (ARG / 10) < 600
	CALL tikagai_TILE2,ARG
ELSEIF  (ARG / 10) < 1400
	CALL shuyoujo_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M == 15
	CALL shuyoujo2_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 26
	CALL kyoukai_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 31
	CALL airport_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 40
	CALL rabo_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 44
	CALL plant_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 46
	CALL SEISIN_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 54
	CALL kasou_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 63
	CALL tamago_TILE2, ARG , ARG:1 , ARG:2
ELSEIF FLAG:現M < 95
	CALL taiyou_TILE2, ARG , ARG:1 , ARG:2
ELSE
	RETURN 1
ENDIF

@TILE_MARK_COMMON_13_2, ARG , ARG:1 , ARG:2
#LOCALSIZE 4
	
	LOCAL:0 = (ARG:2 - 1) < 0 ? 0 # GET_FLOOR_ANALYZE_T(ARG:1, ARG:2 - 1)
	LOCAL:1 = (ARG:2 + 1) >= FLAG:최대Y ? 0 # GET_FLOOR_ANALYZE_T(ARG:1, ARG:2 + 1)
	
	LOCAL:2 = (ARG:1 - 1) < 0 ? 0 # GET_FLOOR_ANALYZE_T(ARG:1 - 1, ARG:2)
	LOCAL:3 = (ARG:1 + 1) >= FLAG:최대X ? 0 # GET_FLOOR_ANALYZE_T(ARG:1 + 1, ARG:2)
	
	IF 0 == 1
	
	ELSEIF ARG == 12
		IF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 || (LOCAL:0 > 0 && LOCAL:1 > 0)
			SETCOLOR 0x8888aa
			RESULTS = △
		ELSEIF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2 + 1) > 0
			RESULTS = 문
		ELSE
			RESULTS = ■
		ENDIF
	ELSEIF ARG == 22
		IF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 || (LOCAL:0 > 0 && LOCAL:1 > 0)
			SETCOLOR 0x8888aa
			RESULTS = ▽
		ELSEIF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2 - 1) > 0
			RESULTS = 문
		ELSE
			RESULTS = ■
		ENDIF
	ELSEIF ARG == 32
		IF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 || (LOCAL:2 > 0 && LOCAL:3 > 0)
			SETCOLOR 0x8888aa
			RESULTS = ≫
		ELSEIF GET_FLOOR_ANALYZE_T(ARG:1 - 1, ARG:2) > 0
			RESULTS = 문
		ELSE
			RESULTS = ■
		ENDIF
	ELSEIF ARG == 42
		IF GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2 || (LOCAL:2 > 0 && LOCAL:3 > 0)
			SETCOLOR 0x8888aa
			RESULTS = ≪
		ELSEIF GET_FLOOR_ANALYZE_T(ARG:1 + 1, ARG:2) > 0
			RESULTS = 문
		ELSE
			RESULTS = ■
		ENDIF
	ELSEIF ARG == 92
		RESULTS = □
	ELSEIF ARG:1 == 4 && ARG:2 == 36
		RESULTS = ■
	ELSE
		RETURN 1
	ENDIF
	

@TILE_MARK_COMMON_13_3, ARG , ARG:1 , ARG:2
	IF FLAG:現M == 15
		CALL onmitsu_TILE, ARG , ARG:1 , ARG:2
	ELSE
		RETURN 1
	ENDIF
	

@TILE_MARK_COMMON_13_5, ARG , ARG:1 , ARG:2
IF ARG == 15
	SETCOLOR 0xffff00
	RESULTS = １
ELSEIF ARG == 25
	SETCOLOR 0xffb900
	RESULTS = ２
ELSEIF ARG == 35
	SETCOLOR 0xff7300
	RESULTS = ３
ELSEIF ARG == 95 && GET_FLOOR_ANALYZE_T(ARG:1, ARG:2) == 2
	SETCOLOR 0xbb0033
	RESULTS = 穴
ELSEIF FLAG:現M == 15
	CALL onmitsu_TILE, ARG , ARG:1 , ARG:2
ELSE
	RETURN 1
ENDIF


@TILE_MARK_COMMON_13_1, ARG , ARG:1 , ARG:2
	IF FLAG:現M == 15
		CALL onmitsu_TILE, ARG , ARG:1 , ARG:2
	ELSEIF ARG == 11
		SETCOLOR 0x6d79a8
		RESULTS = ∧
	ELSEIF ARG == 21
		SETCOLOR 0x6d79a8
		RESULTS = ∨
	ELSEIF ARG == 31
		SETCOLOR 0x6d79a8
		RESULTS = ＞
	ELSEIF ARG == 41
		SETCOLOR 0x6d79a8
		RESULTS = ＜
	ELSEIF ARG == 51
		SETCOLOR 0x16fafa
		RESULTS = 曰
	ELSE
		RETURN 1
	ENDIF

;=======================================================================
;[5]調べる　実行時の이벤트
;=======================================================================
@EVENT_CHECK_DUNGEON_13
SIF FLAG:現M == 15
	CALL onmitsu_event_sw
SIF FLAG:現M == 0 && FLAG:現X > 23 && FLAG:現Y > 19
	CALL DUNGEON_WORP,0,14,18

;==========
;出입の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) == 8
	FLAG:エンカウント率 = 0
	IF 던전フラグ:13:1 > 2
		PRINTFORML 어디로 갑니까？
		PRINTFORML [ 0] 로카파라 아지트
		PRINTFORML [ 1] 카르마 시티 시가지
		IF 던전フラグ:13:1 > 15
			PRINTFORML [ 2] 太陽への道
		ELSEIF 던전フラグ:13:1 > 4
			PRINTFORML [ 2] 잘란다라 아지트
		ENDIF
		PRINTFORML [10] 돌아간다
		INPUT
		IF RESULT == 0
			CALL DUNGEON_WORP,0,3,2
		ELSEIF RESULT == 1
			CALL DUNGEON_WORP,14,3,12
		ELSEIF RESULT == 2 && 던전フラグ:13:1 > 15
			CALL DUNGEON_WORP,63,6,4
		ELSEIF RESULT == 2 && 던전フラグ:13:1 > 4
			CALL DUNGEON_WORP,99,2,47
		ELSEIF RESULT == 10
			CALL DUNGEON_EXIT
			RETURN 1
		ENDIF
	ELSE
		CALL DUNGEON_EXIT
		RETURN 1
	ENDIF
;========
;宝の処理
;========
;% 10は10で割ったあまり、つまり下一桁がでてきます
;そして、下一桁はタイルの종류を表す
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	IF FLAG:現M == 15
		FLAG:未遭遇歩数++
		CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
		RETURN 0
	ENDIF
	CALL TREASURE_13
	RETURN RESULT
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 6
	CALL UPSTAIRS_13
	RETURN RESULT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 7
	CALL DOWNSTAIRS_13
	RETURN RESULT
;========
;이벤트
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4
	IF FLAG:現M == 0
		CALL Lokapala_event
	ELSEIF  FLAG:現M < 6
		CALL tikagai_event_sw
	ELSEIF  FLAG:現M < 14
		CALL shuyoujo_event_sw
	ELSEIF  FLAG:現M == 14
		CALL karumasity_event
	ELSEIF FLAG:現M < 26
		CALL kyoukai_event_sw
	ELSEIF FLAG:現M < 31
		CALL airport_event_sw
	ELSEIF FLAG:現M < 40
		CALL rabo_event_sw
	ELSEIF FLAG:現M < 44
		CALL plant_event_sw
	ELSEIF FLAG:現M < 46
		CALL SEISIN_event_sw
	ELSEIF FLAG:現M < 54
		CALL kasou_event_sw
	ELSEIF FLAG:現M < 63
		CALL tamago_event_sw
	ELSEIF FLAG:現M < 95
		CALL taiyou_event_sw
	ENDIF
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 9
	SELECTCASE DA:(FLAG:現X):(FLAG:現Y) / 10
		;ローカパーラ이벤트
		CASE 0
			IF 던전フラグ:13:1 > 0
				CALL DUNGEON_TERMINAL
			ENDIF
		CASE 1
			IF 던전フラグ:13:1 > 0
				CALL MESSAGE_WINDOW_D, "", "ここで仲間の入れ替えができそうだ "
				CALL INPUT_SELECT_D, "[1]仲間を入れ替える/[0]何でもない "
				SIF RESULT == 1
					CALL RECONSTRUCTION
			ENDIF
		CASE 2
			CALL Lokapala_event2
	ENDSELECT
	IF FLAG:現M == 15
		FLAG:未遭遇歩数++
		CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
		RETURN 0
	ENDIF
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 5
	SELECTCASE DA:(FLAG:現X):(FLAG:現Y)
		CASE 15,25,35
			CALL JUMPING_13
	ENDSELECT
ELSE
	IF FLAG:現M == 15
		FLAG:未遭遇歩数++
		CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
		RETURN 0
	ELSE
		CALL MESSAGE_WINDOW_D, "", "＞아무 것도 없는 것 같다"
		RETURN 0
	ENDIF
ENDIF
RETURN 0

@JUMPING_13
#LOCALSIZE 3
CALL 高低差_13,(FLAG:現X),(FLAG:現Y)
LOCAL:0 = RESULT
CALL 高低差_13,(FLAG:現X),(FLAG:現Y)+1
LOCAL:1 = RESULT
CALL 高低差_13,(FLAG:現X),(FLAG:現Y)+2
LOCAL:2 = RESULT
IF LOCAL:0 > LOCAL:1 && LOCAL:0 == LOCAL:2
	CALL SHOW_FORCEMOVE, "DD", "D", , ,  "南に飛んだ"
	CALL EVENT_ENTER_DUNGEON_13,0
	;CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)+2
	RETURN 0
ENDIF
CALL 高低差_13,(FLAG:現X)+1,(FLAG:現Y)
LOCAL:1 = RESULT
CALL 高低差_13,(FLAG:現X)+2,(FLAG:現Y)
LOCAL:2 = RESULT
IF LOCAL:0 > LOCAL:1 && LOCAL:0 == LOCAL:2
	CALL SHOW_FORCEMOVE, "RR", "D", , ,  "東に飛んだ"
	CALL EVENT_ENTER_DUNGEON_13,0
	;CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X)+2,(FLAG:現Y)
	RETURN 0
ENDIF
IF (FLAG:現Y)-2 > -1
	CALL 高低差_13,(FLAG:現X),(FLAG:現Y)-1
	LOCAL:1 = RESULT
	CALL 高低差_13,(FLAG:現X),(FLAG:現Y)-2
	LOCAL:2 = RESULT
	IF LOCAL:0 > LOCAL:1 && LOCAL:0 == LOCAL:2
		CALL SHOW_FORCEMOVE, "UU", "D", , ,  "北に飛んだ"
		CALL EVENT_ENTER_DUNGEON_13,0
		;CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)-2
		RETURN 0
	ENDIF
ENDIF
IF (FLAG:現X)-2 > -1
	CALL 高低差_13,(FLAG:現X)-1,(FLAG:現Y)
	LOCAL:1 = RESULT
	CALL 高低差_13,(FLAG:現X)-2,(FLAG:現Y)
	LOCAL:2 = RESULT
	IF LOCAL:0 > LOCAL:1 && LOCAL:0 == LOCAL:2
		CALL SHOW_FORCEMOVE, "LL", "D", , ,  "東に飛んだ"
		CALL EVENT_ENTER_DUNGEON_13,0
		;CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X)-2,(FLAG:現Y)
		RETURN 0
	ENDIF
ENDIF

@高低差_13,ARG,ARG:1
SELECTCASE DA:(ARG):(ARG:1) % 10
	CASE 0,2,6,7,8,3,4,9
		RETURN 99
	CASE 1
		RETURN 0
	CASE 5
		SIF DA:(ARG):(ARG:1) == 35
			RETURN 3
		SIF DA:(ARG):(ARG:1) == 25
			RETURN 2
		SIF DA:(ARG):(ARG:1) == 15
			RETURN 1
		RETURN 0
	CASEELSE
		RETURN 99
ENDSELECT
;=======================================================================
;タイル進入時の이벤트
;=======================================================================
@EVENT_ENTER_DUNGEON_13,ARG
#LOCALSIZE 4
#LOCALSSIZE 1
;ARG = 進入時の向き　0の場合ワープなど
;RESTART

;LOCAL 51の滑る床用
SIF FLAG:現M == 15
	CALL onmitsu_event
IF ループ関数_13() > 0
	CALL ループワープ_13
	CALL ループ踏破_13
ENDIF
;==========
;出입の処理
;==========
IF DA:(FLAG:現X):(FLAG:現Y) % 10 == 8
	FLAG:エンカウント率 = 0
	IF 던전フラグ:13:1 > 2
		PRINTFORML 어디로 갑니까？
		PRINTFORML [ 0] 로카파라 아지트
		PRINTFORML [ 1] 카르마 시티 시가지
		IF 던전フラグ:13:1 > 15
			PRINTFORML [ 2] 太陽への道
		ELSEIF 던전フラグ:13:1 > 4
			PRINTFORML [ 2] 잘란다라 아지트
		ENDIF
		PRINTFORML [10] 돌아간다
		INPUT
		IF RESULT == 0
			CALL DUNGEON_WORP,0,3,2
		ELSEIF RESULT == 1
			CALL DUNGEON_WORP,14,3,12
		ELSEIF RESULT == 2 && 던전フラグ:13:1 > 15
			CALL DUNGEON_WORP,63,6,4
		ELSEIF RESULT == 2 && 던전フラグ:13:1 > 4
			CALL DUNGEON_WORP,99,2,47
		ELSEIF RESULT == 10
			CALL DUNGEON_EXIT
			RETURN 1
		ENDIF
	ELSE
		CALL DUNGEON_EXIT
		RETURN 1
	ENDIF
;========
;宝の処理
;========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 3
	CALL TREASURE_13
	RETURN RESULT
;=======
;階段
;=======
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 6
	CALL UPSTAIRS_13
	RETURN RESULT

ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 7
	CALL DOWNSTAIRS_13
	RETURN RESULT

;==========
;扉の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 2
	IF DA:(FLAG:現X):(FLAG:現Y) == 92
	ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 12
		CALL SET_FLOOR_ANALYZE(2, FLAG:現던전, FLAG:現M, FLAG:現X, FLAG:現Y)
		CALL WALK_DUNGEON,8
	ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 22
		CALL SET_FLOOR_ANALYZE(2, FLAG:現던전, FLAG:現M, FLAG:現X, FLAG:現Y)
		CALL WALK_DUNGEON,2
	ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 32
		CALL SET_FLOOR_ANALYZE(2, FLAG:現던전, FLAG:現M, FLAG:現X, FLAG:現Y)
		CALL WALK_DUNGEON,6
	ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 42
		CALL SET_FLOOR_ANALYZE(2, FLAG:現던전, FLAG:現M, FLAG:現X, FLAG:現Y)
		CALL WALK_DUNGEON,4
	ELSE
		CALL DUNGEON_DOOR,ARG
	ENDIF
	RETURN 1

;==========
;罠の処理
;==========
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 1
		IF DA:(FLAG:現X):(FLAG:現Y) == 11
			TWAIT 100, 0
			FLAG:現Y--
			CALL AUTOMAP
			CALL SHOW_PICTURE, "D"
			CALL SHOW_DUNGEON_COMMAND
			LOCAL = 8
			CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
			;CALL SHOW_FORCEMOVE, "U", "D", , ,  ""
		ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 21
			TWAIT 100, 0
			FLAG:現Y++
			CALL AUTOMAP
			CALL SHOW_PICTURE, "D"
			CALL SHOW_DUNGEON_COMMAND
			LOCAL = 2
			CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
			;CALL SHOW_FORCEMOVE, "D", "D", , ,  ""
		ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 31
			TWAIT 100, 0
			FLAG:現X++
			CALL AUTOMAP
			CALL SHOW_PICTURE, "D"
			CALL SHOW_DUNGEON_COMMAND
			LOCAL = 6
			CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
			;CALL SHOW_FORCEMOVE, "R", "D", , ,  ""
		ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 41
			TWAIT 100, 0
			FLAG:現X--
			CALL AUTOMAP
			CALL SHOW_PICTURE, "D"
			CALL SHOW_DUNGEON_COMMAND
			LOCAL = 4
			CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
			;CALL SHOW_FORCEMOVE, "L", "D", , ,  ""
		ELSEIF DA:(FLAG:現X):(FLAG:現Y) == 51
			;LOCAL:1 X軸
			;LOCAL:2 Y軸
			SIF ARG > 0 && ARG < 10 && ARG % 2 == 0
				LOCAL = ARG
			LOCAL:1 = FLAG:現X
			LOCAL:2 = FLAG:現Y
			SIF LOCAL == 2
				LOCAL:2 ++
			SIF LOCAL == 8
				LOCAL:2 --
			SIF LOCAL == 6
				LOCAL:1 ++
			SIF LOCAL == 4
				LOCAL:1 --
			SKIPDISP 1
			CALL CAN_ENTER_13,LOCAL:1,LOCAL:2
			LOCAL:3 = RESULT
			SKIPDISP 0
			IF LOCAL:3 && LOCAL > 0 && LOCAL < 10 && LOCAL % 2 == 0 && DA:(LOCAL:1):(LOCAL:2) != 15 && DA:(LOCAL:1):(LOCAL:2) != 25 && DA:(LOCAL:1):(LOCAL:2) != 35
				
				FLAG:現X = LOCAL:1
				FLAG:現Y = LOCAL:2
				TWAIT 100, 0
				CALL AUTOMAP
				CALL SHOW_PICTURE, "D"
				CALL SHOW_DUNGEON_COMMAND
				CALL DUNGEON_WORP,(FLAG:現M),(FLAG:現X),(FLAG:現Y)
				;CALL DUNGEON_WORP,(FLAG:現M),(LOCAL:1),(LOCAL:2)
				;CALL SHOW_FORCEMOVE, LOCALS, "D", , ,  ""
			ELSE
				LOCAL = 0
			ENDIF
		ENDIF
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 5
	IF DA:(FLAG:現X):(FLAG:現Y) == 95
		CALL MESSAGE_B,3, "落とし穴だ！ "
		CALL DUNGEON_WORP,(FLAG:現M)-1,(FLAG:現X),(FLAG:現Y)
	ELSEIF FLAG:現M > 50 && FLAG:現M < 53 && DA:(FLAG:現X):(FLAG:現Y) < 36
		CALL 床崩れ
	ELSEIF DA:(FLAG:現X):(FLAG:現Y) > 35
		CALL TRAP_13
		RETURN RESULT
	ENDIF

;========================
;이벤트
;========================
ELSEIF DA:(FLAG:現X):(FLAG:現Y) % 10 == 4
	SELECTCASE DA:(FLAG:現X):(FLAG:現Y) /10
		;１Ｆ이벤트
		CASE 1
	ENDSELECT
	IF FLAG:現M > 0 && FLAG:現M < 6
		CALL tikagai_event
	ELSEIF  FLAG:現M < 14
		CALL shuyoujo_event
	ELSEIF  FLAG:現M == 15
		CALL shuyoujo2_event
	ELSEIF FLAG:現M < 26
		CALL kyoukai_event
	ELSEIF FLAG:現M < 31
		CALL airport_event
	ELSEIF FLAG:現M < 40
		CALL rabo_event
	ELSEIF FLAG:現M < 44
		CALL plant_event
	ELSEIF FLAG:現M < 46
		CALL SEISIN_event
	ELSEIF FLAG:現M < 54
		CALL kasou_event
	ELSEIF FLAG:現M < 63
		CALL tamago_event
	ELSEIF FLAG:現M < 95
		CALL taiyou_event
	ENDIF
ELSEIF DA:(FLAG:現X):(FLAG:現Y) %10 == 9
	SELECTCASE DA:(FLAG:現X):(FLAG:現Y) / 10
		;ローカパーラ이벤트
		CASE 0
			IF 던전フラグ:13:1 > 0
				CALL DUNGEON_TERMINAL
			ENDIF
		CASE 1
			IF 던전フラグ:13:1 > 0
				CALL MESSAGE_WINDOW_D, "", "ここで仲間の入れ替えができそうだ "
				CALL INPUT_SELECT_D, "[1]仲間を入れ替える/[0]何でもない "
				SIF RESULT == 1
					CALL RECONSTRUCTION
			ENDIF
	ENDSELECT
	IF FLAG:現M > 0 && FLAG:現M < 6
		CALL tikagai_event2
	ELSEIF FLAG:現M < 14
		CALL shuyoujo_event2
	ELSEIF  FLAG:現M == 15
	ELSEIF FLAG:現M < 26
		CALL kyoukai_event2
	ELSEIF FLAG:現M < 31
		CALL airport_event2
	ELSEIF FLAG:現M < 40
		CALL rabo_event2
	ELSEIF FLAG:現M < 44
		CALL plant_event2
	ELSEIF FLAG:現M < 46
		CALL SEISIN_event2
	ELSEIF FLAG:現M < 54
		CALL kasou_event2
	ELSEIF FLAG:現M < 63
		CALL tamago_event2
	ELSEIF FLAG:現M < 95
		CALL taiyou_event2
	ENDIF
ENDIF
RETURN 0





;=======================================================================
;エンカウント率
;=======================================================================
@ENCOUNT_RATE_13
FLAG:MAG소비율 = 100
SELECTCASE FLAG:現M
	CASE 2
		IF 던전フラグ:13:2 > 2
			FLAG:エンカウント率 = FLAG:未遭遇歩数*2
		ELSE
			FLAG:エンカウント率 = 0
		ENDIF
	CASE 4,5,32,33,34,35,39
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 13
		IF 던전フラグ:13:4 > 5
			FLAG:エンカウント率 = FLAG:未遭遇歩数*3
		ELSE
			FLAG:エンカウント率 = 0
		ENDIF
	CASE 18,19,21,22,23
		IF 던전フラグ:13:11 > 0 && 던전フラグ:13:11 < 4
			FLAG:エンカウント率 = FLAG:未遭遇歩数*5
		ELSE
			FLAG:エンカウント率 = 0
		ENDIF
	CASE 28,29,30
		IF 던전フラグ:13:11 > 0
			FLAG:エンカウント率 = FLAG:未遭遇歩数*5
		ELSE
			FLAG:エンカウント率 = 0
		ENDIF
	CASE 41,42
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 44,45,47,48,49,50,51,52
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 55,56,57,58,62
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 59,60,61
		FLAG:エンカウント率 = 0
		SIF FLAG:未遭遇歩数 > 10
			FLAG:エンカウント率 = (FLAG:未遭遇歩数 - 10)*2
	CASE 65,66,67,68
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 70,71,72
		FLAG:エンカウント率 = FLAG:未遭遇歩数*6
	CASE 74,75,76
		FLAG:エンカウント率 = FLAG:未遭遇歩数*4
	CASE 78,79,80
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 82,83,84
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASE 85
		FLAG:エンカウント率 = FLAG:未遭遇歩数*20
	CASE 99
		FLAG:エンカウント率 = FLAG:未遭遇歩数*3
	CASEELSE
		FLAG:エンカウント率 = 0
		FLAG:MAG소비율 = 0
ENDSELECT
	

;=======================================================================
;필요레벨눈,安
;권장LV 雑물고기최저LV 雑물고기最高LV ボスLV 
;=======================================================================
@GET_DUNGEON_LV_13
	SIF 던전フラグ:13:1 < 1
		RETURN 20, 18, 23, 28
	SIF 던전フラグ:13:1 < 3
		RETURN 27, 25, 32, 37
	SIF 던전フラグ:13:1 < 5
		RETURN 37, 35, 44, 50
	SIF 던전フラグ:13:1 < 7
		RETURN 47, 45, 51, 55
	SIF 던전フラグ:13:1 < 9
		RETURN 52, 50, 55, 61
	SIF 던전フラグ:13:1 < 11
		RETURN 60, 57, 63, 70
	SIF 던전フラグ:13:1 < 13
		RETURN 65, 62, 68, 75
	SIF 던전フラグ:13:1 < 15
		RETURN 70, 68, 78, 83
	SIF 던전フラグ:13:1 < 17
		RETURN 81, 79, 95, 99
;=======================================================================
;エンカウント処理
;=======================================================================
@CHECK_ENCOUNT_13
IF RAND:100 < FLAG:エンカウント率
	CALL ENEMY_TABLE
	IF 던전フラグ:13:8 > 1
		CALL 占い効果
		ABL:(CHARANUM-1):아이템3 = RESULT
		ABL:(CHARANUM-1):입수확률3 = RESULT:1
	ENDIF
;	IF RAND:3 == 1
;		ABL:(CHARANUM-1):아이템2 = 1415
;		ABL:(CHARANUM-1):입수확률2 = 8
;	ELSEIF RAND:2 == 1
;		ABL:(CHARANUM-1):아이템2 = 1416
;		ABL:(CHARANUM-1):입수확률2 = 8
;	ELSE
;		ABL:(CHARANUM-1):아이템2 = 1417
;		ABL:(CHARANUM-1):입수확률2 = 8
;	ENDIF
;	
	RETURN 1
ELSE
	FLAG:未遭遇歩数 += 1
	RETURN 0
ENDIF
;=======================================================================
;적の종족の종류数
;RETURN X でXが종류の数になります
;あまりいろんなのが混ざっているとCOOPがとりにくくなったり
;적の공격속성が多くなる傾向にあるので、
;종류の数は1・2종류を主体に時々3종류くらいを기본にするのが望ましいと思われます
;=======================================================================
@CLASS_NUM_13
SELECTCASE FLAG:現M
	CASE IS < 13
		RETURN CLASS_NUM_COMMON("初級")
	CASE 13
		RETURN CLASS_NUM_COMMON("初級")
	CASE IS < 26
		RETURN CLASS_NUM_COMMON("中級")
	CASE IS < 31
		RETURN CLASS_NUM_COMMON("中級")
	CASE IS < 44
		RETURN CLASS_NUM_COMMON("中級")
	CASE IS < 46
		RETURN CLASS_NUM_COMMON("上級")
	CASE IS < 63
		RETURN CLASS_NUM_COMMON("上級")
	CASE 85
		RETURN CLASS_NUM_COMMON("最上級")
	CASE IS < 87
		RETURN CLASS_NUM_COMMON("上級")
	CASE 99
		SELECTCASE FLAG:現Y
			CASE IS < 10
				RETURN CLASS_NUM_COMMON("最上級")
			CASE IS < 20
				RETURN CLASS_NUM_COMMON("上級")
			CASE IS < 30
				RETURN CLASS_NUM_COMMON("中級")
			CASEELSE
				RETURN CLASS_NUM_COMMON("初級")
		ENDSELECT
ENDSELECT
RETURN CLASS_NUM_COMMON("初級")

;=======================================================================
;적の総数
;ARGは出現する적の종류です
;RAND(X, Y)はX〜Y-1のうちのどれかになるRANDです
;なお、ここで帰った数字は下限を종족数、上限を10として自動的に調整されます
;
;에코빌딩は最初の던전ということで少なめで、최대でも6体ということに
;=======================================================================
@ENEMY_NUM_13, ARG
SELECTCASE FLAG:現M
	CASE IS < 13
		RETURN ENEMY_NUM_COMMON("初級", ARG)
	CASE 13
		RETURN ENEMY_NUM_COMMON("中級", ARG)
	CASE IS < 26
		RETURN ENEMY_NUM_COMMON("中級", ARG)
	CASE IS < 31
		RETURN ENEMY_NUM_COMMON("中級", ARG)
	CASE IS < 44
		RETURN ENEMY_NUM_COMMON("中級", ARG)
	CASE IS < 46
		RETURN ENEMY_NUM_COMMON("上級", ARG)
	CASE 85
		RETURN ENEMY_NUM_COMMON("最上級", ARG)
	CASE IS < 87
		RETURN ENEMY_NUM_COMMON("上級", ARG)
	CASE 99
		SELECTCASE FLAG:現Y
			CASE IS < 10
				RETURN ENEMY_NUM_COMMON("最上級", ARG)
			CASE IS < 20
				RETURN ENEMY_NUM_COMMON("上級", ARG)
			CASE IS < 30
				RETURN ENEMY_NUM_COMMON("中級", ARG)
			CASEELSE
				RETURN ENEMY_NUM_COMMON("初級", ARG)
		ENDSELECT
ENDSELECT
RETURN ENEMY_NUM_COMMON("初級", ARG)

;=======================================================================
;적스테이터스설정
;=======================================================================
@SET_ENEMY_STATUS_13,ARG
SIF FLAG:現M == 99 || FLAG:現M < 47
	ABL:(CHARANUM-1):회화타입 = 331
SIF 던전フラグ:13:8 == 1
	CFLAG:(CHARANUM-1):ＥＸＰ보정 += COEFFICIENT_EXP(ABL:(CHARANUM-1):종족)/2

IF FLAG:現M > 30 && FLAG:現M < 40
	CALL rabo_ENEMY_STATUS,ARG
ELSEIF FLAG:現M < 44
ELSEIF FLAG:現M < 46
	CALL SEISIN_ENEMY_STATUS,ARG
ELSEIF FLAG:現M < 54
	CALL kasou_ENEMY_STATUS,ARG
ELSEIF FLAG:現M < 63
ELSEIF FLAG:現M < 95
ENDIF
;=======================================================================
;적の종류
;=======================================================================
@ENEMY_13, ARG
#LOCALSIZE 3
LOCAL = 0
LOCAL:1 = 0
;SIF FLAG:現M > 0 && FLAG:現M < 6
;	CALL tikagai_enemy
;	CALL shuyoujo_enemy
SELECTCASE FLAG:現M
	;地下街
	CASE IS < 4
		IF RAND:7 == 0
			RETURN [[キャラ:랴난시]], 18 + RAND:2
		ELSEIF RAND:6 == 0
			RETURN [[キャラ:루살카]], 18 + RAND:2
		ELSEIF RAND:5 == 0
			RETURN [[キャラ:오퀴페테]], 18 + RAND:2
		ELSEIF RAND:4 == 0
			RETURN [[キャラ:잔트만]], 18 + RAND:2
		ELSEIF RAND:3 == 0
			RETURN [[キャラ:세에레]], 18 + RAND:2
		ELSEIF RAND:2 == 0
			RETURN [[キャラ:키마리스]], 18 + RAND:2
		ELSE
			RETURN [[キャラ:야마치치]], 18 + RAND:2
		ENDIF
	CASE 4,5
		IF RAND:13 == 0
			RETURN [[キャラ:랴난시]], 18 + RAND:2
		ELSEIF RAND:12 == 0
			RETURN [[キャラ:루살카]], 18 + RAND:2
		ELSEIF RAND:11 == 0
			RETURN [[キャラ:오퀴페테]], 18 + RAND:2
		ELSEIF RAND:10 == 0
			RETURN [[キャラ:잔트만]], 18 + RAND:2
		ELSEIF RAND:9 == 0
			RETURN [[キャラ:세에레]], 18 + RAND:2
		ELSEIF RAND:8 == 0
			RETURN [[キャラ:키마리스]], 18 + RAND:2
		ELSEIF RAND:7 == 0
			RETURN [[キャラ:야마치치]], 18 + RAND:2
		ELSEIF RAND:6 == 0
			RETURN [[キャラ:아리안로드]], 19 + RAND:4
		ELSEIF RAND:5 == 0
			RETURN [[キャラ:스세리비메]],19 + RAND:4
		ELSEIF RAND:4 == 0
			RETURN [[キャラ:가름]], 19 + RAND:4
		ELSEIF RAND:3 == 0
			RETURN [[キャラ:오니]], 19 + RAND:4
		ELSEIF RAND:2 == 0
			RETURN [[キャラ:유키죠로]], 19 + RAND:4
		ELSE
			RETURN [[キャラ:세탄타]], 19 + RAND:4
		ENDIF
	CASE IS < 14
		CALL shuyoujo_enemy(0)
		LOCAL = RESULT
		CALL shuyoujo_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 24
		CALL kyoukai_enemy(0)
		LOCAL = RESULT
		CALL kyoukai_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 31
		CALL airport_enemy(0)
		LOCAL = RESULT
		CALL airport_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 40
		CALL rabo_enemy(0)
		LOCAL = RESULT
		CALL rabo_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 44
		CALL plant_enemy(0)
		LOCAL = RESULT
		CALL plant_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 46
		CALL SEISIN_enemy(0)
		LOCAL = RESULT
		CALL SEISIN_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 54
		CALL kasou_enemy(0)
		LOCAL = RESULT
		CALL kasou_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 63
		CALL tamago_enemy(0)
		LOCAL = RESULT
		CALL tamago_enemy(1)
		LOCAL:1 = RESULT
	CASE IS < 95
		CALL taiyou_enemy(0)
		LOCAL = RESULT
		CALL taiyou_enemy(1)
		LOCAL:1 = RESULT
	CASE 99
		SELECTCASE 던전フラグ:13:1
			CASE IS < 7
				CALL kyoukai_enemy(0)
				LOCAL = RESULT
				CALL kyoukai_enemy(1)
				LOCAL:1 = RESULT
			CASE IS < 9
				CALL rabo_enemy(0)
				LOCAL = RESULT
				CALL rabo_enemy(1)
				LOCAL:1 = RESULT
			CASE IS < 11
				CALL plant_enemy(0)
				LOCAL = RESULT
				CALL plant_enemy(1)
				LOCAL:1 = RESULT
			CASE IS < 13
				CALL SEISIN_enemy(0)
				LOCAL = RESULT
				CALL SEISIN_enemy(1)
				LOCAL:1 = RESULT
			CASE IS < 15
				CALL kasou_enemy(0)
				LOCAL = RESULT
				CALL kasou_enemy(1)
				LOCAL:1 = RESULT
			CASEELSE
				CALL tamago_enemy(0)
				LOCAL = RESULT
				CALL tamago_enemy(1)
				LOCAL:1 = RESULT
		ENDSELECT
	CASEELSE
ENDSELECT

SIF LOCAL > 0 && LOCAL:1 > 0
	RETURN LOCAL, LOCAL:1

SIF !RAND:3
	RETURN 1028, 1
SIF !RAND:2
	RETURN 1093, 1
	
	RETURN 1701, 1



;=======================================================================
;バトルターン終了時の이벤트
;=======================================================================
@EVENT_BATTLE_TURNEND_DUNGEON13
SELECTCASE FLAG:現M
	CASE IS < 14
		CALL EVENT_BATTLE_shuyoujo
	CASE 37
		CALL EVENT_BATTLE_rabo
	CASE IS < 53
	CASE 53
		CALL EVENT_BATTLE_kasou
	CASE IS < 63
		CALL EVENT_BATTLE_tamago
	CASE IS < 95
		CALL EVENT_BATTLE_taiyou
ENDSELECT
;=======================================================================
;宝箱の中身
;=======================================================================
@TREASURE_13
#LOCALSIZE 3
;宝箱のフラグ管理用変数の番号
LOCAL = FLAG:現M + 40
;そのマップの何番눈の宝箱か
LOCAL:1 = (DA:(FLAG:現X):(FLAG:現Y) / 10) % 100

;/10はIDを10で割る。つまり、下一桁をなくして、二桁눈と三桁눈を二桁の数字として取り出している

;地下街（1〜5）
IF FLAG:現M > 0 && FLAG:現M < 6
	CALL tikagai_takara
ELSEIF  FLAG:現M < 14
	CALL shuyoujo_takara
ELSEIF FLAG:現M < 26
	CALL kyoukai_takara
ELSEIF FLAG:現M < 31
	CALL airport_takara
ELSEIF FLAG:現M < 40
	CALL rabo_takara
ELSEIF FLAG:現M < 44
	CALL plant_takara
ELSEIF FLAG:現M < 46
	CALL SEISIN_takara
ELSEIF FLAG:現M < 54
	CALL kasou_takara
ELSEIF FLAG:現M < 63
	CALL tamago_takara
ELSEIF FLAG:現M < 95
	CALL taiyou_takara
ENDIF
	;マップ番号*100+そのマップで何番눈の宝箱かを示す数値でどの宝箱かを判別します。
	;例えば0の場合、0版のマップの0番눈の宝箱であることを表しています。
RETURN 1

;========
;罠置き場
;========
@TRAP_13
IF FLAG:現M == 44
	IF DA:(FLAG:現X):(FLAG:現Y)/10 % 2
		CALL DUNGEON_TRAP_HP,10
	ELSE
		CALL DUNGEON_TRAP_BADSTATE, GET_STATE_NUM("CURSE"), 40
	ENDIF
ELSEIF FLAG:現M == 45
	IF DA:(FLAG:現X):(FLAG:現Y)/10 % 2
		CALL DUNGEON_TRAP_HP,10
	ELSE
		CALL DUNGEON_TRAP_BADSTATE, GET_STATE_NUM("BRAND"), 40
	ENDIF
ELSEIF FLAG:現M > 50 && FLAG:現M < 53
	CALL DUNGEON_TRAP_HP,10
ELSE
	CALL DUNGEON_TRAP_HP,7
ENDIF

;=======================================================================
;階段置き場
;=======================================================================
;上り階段処理
@UPSTAIRS_13
#LOCALSIZE 3
LOCAL = DA:(FLAG:現X):(FLAG:現Y) /10 + 100
SELECTCASE DA:(FLAG:現X):(FLAG:現Y) /10
;	;IDで分岐
;	;１Ｆ上り階段
;	CASE 0
;			;@DUNGEON_UPSTAIRS_ID , 階段を進んだ先のマップ番号 , 移動先のタイルのID
;			;２Ｆ＝マップ番号1番の0番눈の下り階段 = 1 * 1000 + 0 * 10 + 7 = 1007へと飛ぶ
;			CALL DUNGEON_UPSTAIRS_ID, 1 , 1007
;	CASE 100
;			CALL DUNGEON_UPSTAIRS_ID, 2 , 2007
;	CASE 200
;			CALL DUNGEON_UPSTAIRS_ID, 3 , 3007
;	CASE 300
;			CALL DUNGEON_UPSTAIRS_ID, 4 , 4007
	CASEELSE
		CALL DUNGEON_UPSTAIRS_ID, FLAG:現M+1 , LOCAL * 10 + 7
ENDSELECT

;入り組んだ던전で階段がたくさん入り乱れている상태であれば、上記のように階段毎に指定してあげる필요があります。
;しかしこの에코빌딩は1つのマップに上り階段が１つ、下り階段が１つ、上の階に進む＝マップ番号が一つ増えるという구조になっています
;なので、下記のように書けば一行で済みます
RETURN 1

;下り階段処理
@DOWNSTAIRS_13
#LOCALSIZE 3
LOCAL = DA:(FLAG:現X):(FLAG:現Y) /10 - 100
;上り階段同様に、에코빌딩は下り階段も1行で記述できます
CALL DUNGEON_DOWNSTAIRS_ID, FLAG:現M-1 , LOCAL * 10 + 6
RETURN 1

;=======================================================================
;エレベーター定義
;=======================================================================
;ARGはそのエレベーターのタイル
@DUNGEON_ELEVATOR_13, ARG
;RESULT:1〜5にエレベータが存在するマップの番号を代入し、RESULTS:1〜5には표시したい명칭を代入、RETURNでは-1を返しておく

IF FLAG:現M > 7 && FLAG:現M < 14
	RESULT:1 = 9
	RESULT:2 = 13
	RESULTS:1 = Ｂ４Ｆ
	RESULTS:2 = １Ｆ
ELSEIF  FLAG:現M < 19
	RESULT:1 = 17
	RESULT:2 = 18
	RESULTS:1 = ２Ｆ
	RESULTS:2 = １０Ｆ
ELSEIF  FLAG:現M < 21
	RESULT:1 = 19
	RESULT:2 = 20
	RESULTS:1 = １１Ｆ
	RESULTS:2 = ２０Ｆ
ELSEIF  FLAG:現M < 24
	RESULT:1 = 22
	RESULT:2 = 23
	RESULTS:1 = ２２Ｆ
	RESULTS:2 = ４４Ｆ
ELSEIF  FLAG:現M < 26
	RESULT:1 = 24
	RESULT:2 = 25
	RESULTS:1 = ４５Ｆ
	RESULTS:2 = ５５Ｆ
ELSEIF  FLAG:現M == 31||FLAG:現M == 33
	RESULT:1 = 31
	RESULT:2 = 33
	RESULTS:1 = １Ｆ
	RESULTS:2 = Ｂ５Ｆ
ELSEIF  FLAG:現M == 32||FLAG:現M == 35
	RESULT:1 = 32
	RESULT:2 = 35
	RESULTS:1 = Ｂ６Ｆ
	RESULTS:2 = Ｂ10Ｆ
ELSEIF  FLAG:現M < 38
	RESULT:1 = 36
	RESULT:2 = 37
	RESULTS:1 = Ｂ11Ｆ
	RESULTS:2 = Ｂ30Ｆ
ELSEIF  FLAG:現M < 63
ELSEIF  FLAG:現M < 95
	RESULT:1 = 64
	RESULTS:1 = 対流層
	IF 던전フラグ:13:31 > 0
		RESULT:2 = 69
		RESULTS:2 = 第二層 5F
	ENDIF
	IF 던전フラグ:13:31 > 1
		RESULT:3 = 73
		RESULTS:3 = 第三層 4F
	ENDIF
	IF 던전フラグ:13:31 > 2
		RESULT:4 = 77
		RESULTS:4 = 第四層 4F
	ENDIF
	IF 던전フラグ:13:31 > 3
		RESULT:5 = 81
		RESULTS:5 = 第五層 4F
	ENDIF
	IF 던전フラグ:13:31 > 4
		RESULT:6 = 86
		RESULTS:6 = 第六層 5F
	ENDIF
	
ENDIF
RETURN -1

;=======================================================================
;윤간참가악마
;=======================================================================
@DUNGEON_RAPE_DEVIL_13
;랜덤にどの악마が出るか決定
;RETURN CSV番号 , 人数 , 레벨
SELECTCASE RAND:3

ENDSELECT

@HEAL_SPOT

PRINTL 힐 스폿이 있다。 
CALL INPUT_YN,"사용한다（한 번 사용하면 사라집니다）","사용하지 않는다"
IF RESULT == 0
	PRINTFORMW %CALLNAME:MASTER% 일행은 회복했다
	FOR LOCAL, 1, 7
		SIF POS(LOCAL) < 0
			CALL HEALTH_CHARA, POS(LOCAL)
	NEXT
	DA:(FLAG:現X):(FLAG:現Y) = 1
	
ENDIF

